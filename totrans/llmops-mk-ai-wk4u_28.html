<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Answers 1.3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Answers 1.3</h1>
<blockquote>原文：<a href="https://boramorka.github.io/LLM-Book/en/CHAPTER-1/Answers%201.3/">https://boramorka.github.io/LLM-Book/en/CHAPTER-1/Answers%201.3/</a></blockquote>
                
                  


  
  



<h2 id="theory">Theory</h2>
<ol>
<li>Integration of the OpenAI Moderation API: obtain an API key, add a client library on the backend, and insert moderation into the content submission pipeline so all data is analyzed before publication.</li>
<li>Customization: tune sensitivity, focus on specific violations, and use your own allow/deny lists in line with community standards and compliance requirements.</li>
<li>Extending moderation: beyond text, add checks for images and video (using OpenAI tools or third‑party solutions) for comprehensive protection.</li>
<li>Delimiters reduce prompt‑injection risk by separating user input from system instructions and preserving command integrity.</li>
<li>Isolating commands with delimiters clearly separates executable instructions from user data, preventing injection of malicious directives.</li>
<li>Additional measures: strict input validation, least‑privilege design, allow‑lists, regular expressions, monitoring, and logging to detect anomalies.</li>
<li>Direct assessment: ask the model to classify input as an injection attempt or not — this reduces false positives and improves response accuracy.</li>
<li>Response measures: notify and educate users, ask them to rephrase, isolate suspicious content for human review, and dynamically adjust sensitivity.</li>
<li>Pros and cons of direct assessment: accuracy and adaptability versus development/maintenance complexity and the need to balance security with UX.</li>
<li>Combining the Moderation API with anti‑injection strategies significantly improves the safety and integrity of UGC platforms.</li>
</ol>
<h2 id="practice-sketches">Practice (sketches)</h2>
<ol>
<li>
<p>Moderate a single text fragment:
</p><div class="highlight"><pre><span/><code><span class="kn">from</span><span class="w"> </span><span class="nn">openai</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpenAI</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">OpenAI</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">moderate_content</span><span class="p">(</span><span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">moderations</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">"omni-moderation-latest"</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">content</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flagged</span><span class="p">)</span>
</code></pre></div>
</li>
<li>
<p>Remove a delimiter from a string:
</p><div class="highlight"><pre><span/><code><span class="k">def</span><span class="w"> </span><span class="nf">sanitize_delimiter</span><span class="p">(</span><span class="n">input_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">input_text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">delimiter</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
</code></pre></div>
</li>
<li>
<p>Check input length:
</p><div class="highlight"><pre><span/><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_input_length</span><span class="p">(</span><span class="n">input_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">min_length</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_text</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_length</span>
</code></pre></div>
</li>
<li>
<p>User session with simple heuristics:
</p><div class="highlight"><pre><span/><code><span class="k">class</span><span class="w"> </span><span class="nc">UserSession</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">user_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trust_level</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_level</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">adjust_sensitivity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trust_level</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_level</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_level</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_level</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitivity_level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">evaluate_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_input</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">dangerous_keywords</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"exec"</span><span class="p">,</span> <span class="s2">"delete"</span><span class="p">,</span> <span class="s2">"drop"</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">user_input</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dangerous_keywords</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">handle_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_input</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_input</span><span class="p">(</span><span class="n">user_input</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trust_level</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">"Input flagged and sent for security review."</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">"The request looks suspicious. Please clarify or rephrase."</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"Input accepted. Thank you!"</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Remember: input should be clear and free of potentially dangerous commands."</span><span class="p">)</span>
</code></pre></div>
</li>
<li>
<p>Direct assessment for injection (stub logic):
</p><div class="highlight"><pre><span/><code><span class="k">def</span><span class="w"> </span><span class="nf">direct_evaluation_for_injection</span><span class="p">(</span><span class="n">user_input</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="s2">"ignore instructions"</span> <span class="ow">in</span> <span class="n">user_input</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">"disregard previous guidelines"</span> <span class="ow">in</span> <span class="n">user_input</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="k">return</span> <span class="s1">'Y'</span>
    <span class="k">return</span> <span class="s1">'N'</span>
</code></pre></div>
</li>
<li>
<p>Example integration in a main loop:
</p><div class="highlight"><pre><span/><code><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">UserSession</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">"Enter text (or 'exit'): "</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">'exit'</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="n">text</span> <span class="o">=</span> <span class="n">sanitize_delimiter</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">"####"</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_input_length</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"Input too short/long."</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">moderate_content</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"Content flagged as unacceptable. Please revise."</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">direct_evaluation_for_injection</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'Y'</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"Potential injection detected. Please rephrase."</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">session</span><span class="o">.</span><span class="n">handle_input</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre></div>
</li>
</ol>












                
                  
</body>
</html>