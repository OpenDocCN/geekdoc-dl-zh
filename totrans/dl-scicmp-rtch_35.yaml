- en: 28  Wavelets
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 28  波浪
- en: 原文：[https://skeydan.github.io/Deep-Learning-and-Scientific-Computing-with-R-torch/wavelets.html](https://skeydan.github.io/Deep-Learning-and-Scientific-Computing-with-R-torch/wavelets.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://skeydan.github.io/Deep-Learning-and-Scientific-Computing-with-R-torch/wavelets.html](https://skeydan.github.io/Deep-Learning-and-Scientific-Computing-with-R-torch/wavelets.html)
- en: We conclude the book with a practical application of *wavelet analysis* using
    `torch`.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 我们用`torch`的实际应用来结束这本书的*波浪分析*。
- en: With the Fourier Transform, it was all about understanding the concepts, so
    we can use `torch_fft_ftt()` with confidence. This time, there is no ready-to-use
    function around; but we’ll see that computing the Wavelet Transform ourselves
    is not that hard. (And yes, `torch_fft_ftt()` will figure prominently, here, too.)
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 使用傅里叶变换时，一切都是关于理解概念，所以我们可以自信地使用`torch_fft_ftt()`。这次，没有现成的函数可用；但我们会看到，自己计算波浪变换并不那么困难。（是的，`torch_fft_ftt()`在这里也将占有一席之地。）
- en: 'What are wavelets? Like the Fourier basis, they’re functions; but they don’t
    extend infinitely. Instead, they are localized in time: Away from the center,
    they quickly decay to zero. In addition to a *location* parameter, they also have
    a *scale*: At different scales, they appear squished or stretched. Squished, they
    will do better at detecting high frequencies; the converse applies when they’re
    stretched out in time.'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 波浪是什么？像傅里叶基一样，它们是函数；但它们不无限延伸。相反，它们在时间上局部化：远离中心，它们迅速衰减到零。除了*位置*参数外，它们还有一个*尺度*：在不同的尺度上，它们看起来会被压缩或拉伸。压缩时，它们将更好地检测高频；当它们在时间上拉伸时，情况相反。
- en: The basic operation involved in the Wavelet Transform is convolution – have
    the (flipped) wavelet slide over the data, computing a sequence of dot products.
    This way, the wavelet is basically looking for *similarity*.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 波浪变换涉及的基本操作是卷积——让（翻转的）波浪函数在数据上滑动，计算一系列点积。这样，波浪函数基本上是在寻找*相似性*。
- en: As to the wavelet functions themselves, there are many of them. In a practical
    application, we’d want to experiment and pick the one that works best for the
    given data. Compared to the DFT and spectrograms, more experimentation tends to
    be involved in wavelet analysis.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 至于波浪函数本身，有很多种。在实际应用中，我们想要实验并选择最适合给定数据的那个。与DFT和频谱图相比，波浪分析通常需要更多的实验。
- en: The topic of wavelets is very different from that of Fourier transforms in other
    respects, as well. Notably, there is a lot less standardization in terminology,
    use of symbols, and actual practices. For these reasons, I will refrain from giving
    a systematic, general introduction, the way I did in the DFT chapter. Instead,
    I’m going to heavily lean on one specific exposition, the one in Arnt Vistnes’
    very nice book on waves ([Vistnes 2018](references.html#ref-waves)). In other
    words, both terminology and examples will reflect the choices made in that book.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 在其他方面，波浪的主题与傅里叶变换的主题也非常不同。值得注意的是，在术语、符号的使用和实际实践中，标准化程度要低得多。出于这些原因，我将避免像在DFT章节中那样给出系统性的、一般性的介绍。相反，我将主要依赖一个特定的阐述，即Arnt
    Vistnes关于波浪的非常棒的书中的阐述（[Vistnes 2018](references.html#ref-waves)）。换句话说，术语和例子都将反映那本书中的选择。
- en: One choice Vistnes made was to favor depth over breadth, and to focus on a single
    wavelet.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: Vistnes做出的一个选择是偏好深度而非广度，并专注于一个单一的波浪函数。
- en: 28.1 Introducing the Morlet wavelet
  id: totrans-9
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 28.1 Morlet波浪的介绍
- en: 'The Morlet, also known as Gabor[¹](#fn1), wavelet is defined like so:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: Morlet波（也称为Gabor[¹](#fn1)）的定义如下：
- en: \[ \Psi_{\omega_{a},K,t_{k}}(t_n) = (e^{-i \omega_{a} (t_n - t_k)} - e^{-K^2})
    \ e^{- \omega_a^2 (t_n - t_k )^2 /(2K )^2} \tag{28.1}\]
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: \[ \Psi_{\omega_{a},K,t_{k}}(t_n) = (e^{-i \omega_{a} (t_n - t_k)} - e^{-K^2})
    \ e^{- \omega_a^2 (t_n - t_k )^2 /(2K )^2} \tag{28.1}\]
- en: This formulation pertains to discretized data, the kinds of data we work with
    in practice. Thus, \(t_k\) and \(t_n\) designate points in time, or equivalently,
    individual time-series samples.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 这个公式适用于离散数据，这是我们实际工作中处理的数据类型。因此，\(t_k\)和\(t_n\)代表时间点，或者等价地，单个时间序列样本。
- en: This equation looks daunting at first, but we can “tame” it a bit by analyzing
    its structure, and pointing to the main actors. For concreteness, though, we first
    look at an example wavelet.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 这个方程一开始看起来很吓人，但我们可以通过分析其结构，并指出主要演员来“驯服”它一点。然而，为了具体起见，我们首先看一个示例波浪函数。
- en: 'We start by implementing [Equation 28.1](#eq-wavelets-1):'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先实现[方程28.1](#eq-wavelets-1)：
- en: '[PRE0]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '*Comparing code and mathematical formulation, we notice a difference. The function
    itself takes one argument, \(t_n\); its realization, four (`omega`, `K`, `t_k`,
    and `t`). This is because the `torch` code is vectorized: On the one hand, `omega`,
    `K`, and `t_k`, which, in [Equation 28.1](#eq-wavelets-1), correspond to \(\omega_{a}\),
    \(K\), and \(t_k\) , are scalars. (In the equation, they’re assumed to be fixed.)
    `t`, on the other hand, is a vector; it will hold the measurement times of the
    series to be analyzed.'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: '*比较代码和数学公式，我们注意到一个差异。函数本身只接受一个参数，\(t_n\)；它的实现，四个（`omega`，`K`，`t_k`和`t`）。这是因为`torch`代码是向量化的：一方面，`omega`，`K`和`t_k`，在[方程28.1](#eq-wavelets-1)中对应于\(\omega_{a}\)，\(K\)和`t_k`，是标量。（在方程中，它们被认为是固定的。）另一方面，`t`是一个向量；它将包含要分析的序列的测量时间。'
- en: 'We pick example values for `omega`, `K`, and `t_k`, as well as a range of times
    to evaluate the wavelet on, and plot its values ([fig. 28.1](#fig-wav-morlet-example)):'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 我们为`omega`，`K`和`t_k`选择示例值，以及一个时间范围来评估小波，并绘制其值（[图28.1](#fig-wav-morlet-example)）：
- en: '[PRE1]'
  id: totrans-18
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '*![Two sine curves, shifted by pi/2, in a Gaussian envelope.](../Images/c1711eaeb29896102b9fce2d2e3c5bad.png)'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: '*![两个相隔\(\pi/2\)的正弦曲线，位于高斯包络内。](../Images/c1711eaeb29896102b9fce2d2e3c5bad.png)'
- en: 'Figure 28.1: A Morlet wavelet.'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 图28.1：一个Morlet小波。
- en: 'What we see here is a complex sine curve – note the real and imaginary parts,
    separated by a phase shift of \(\pi/2\) – that decays on both sides of the center.
    Looking back at [Equation 28.1](#eq-wavelets-1), we can identify the factors responsible
    for both features. The first term in the equation, \(e^{-i \omega_{a} (t_n - t_k)}\),
    generates the oscillation; the third, \(e^{- \omega_a^2 (t_n - t_k )^2 /(2K )^2}\),
    causes the exponential decay away from the center. (In case you’re wondering about
    the second term, \(e^{-K^2}\): For given \(K\), it is just a constant.)'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在这里看到的是一个复杂的正弦曲线——注意实部和虚部，它们通过\(\pi/2\)的相位差分开——在中心两侧都衰减。回顾[方程28.1](#eq-wavelets-1)，我们可以识别出导致这两个特征的因素。方程中的第一项，\(e^{-i
    \omega_{a} (t_n - t_k)}\)，产生了振荡；第三项，\(e^{- \omega_a^2 (t_n - t_k )^2 /(2K )^2}\)，导致中心远离的指数衰减。（如果你对第二项，\(e^{-K^2}\)感到好奇：对于给定的\(K\)，它只是一个常数。）
- en: 'The third term actually is a Gaussian, with location parameter \(t_k\) and
    scale \(K\). We’ll talk about \(K\) in great detail soon, but what’s with \(t_k\)?
    \(t_k\) is the center of the wavelet; for the Morlet wavelet, this is also the
    location of maximum amplitude. As distance from the center increases, values quickly
    approach zero. This is what is meant by wavelets being localized: They are “active”
    only on a short range of time.**  **## 28.2 The roles of \(K\) and \(\omega_a\)'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 第三项实际上是一个高斯函数，其位置参数为\(t_k\)和尺度\(K\)。我们很快会详细讨论\(K\)，但\(t_k\)又是什么？\(t_k\)是小波的中心；对于Morlet小波，这也是最大振幅的位置。随着与中心距离的增加，值迅速接近零。这就是小波局部化的含义：它们只在短时间内“活跃”。**  **##
    28.2 \(K\)和\(\omega_a\)的作用
- en: Now, we already said that \(K\) is the scale of the Gaussian; it thus determines
    how far the curve spreads out in time. But there is also \(\omega_a\). Looking
    back at the Gaussian term, it, too, will impact the spread.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们之前已经说过，\(K\)是高斯尺度；因此，它决定了曲线在时间上扩散多远。但还有\(\omega_a\)。回顾高斯项，它也会影响扩散。
- en: 'First though, what is \(\omega_a\)? The subscript \(a\) stands for “analysis”;
    thus, \(\omega_a\) denotes a single frequency being probed. At this point, a quick
    aside on workflow – this will become much clearer later, when we actually run
    the Wavelet Transform):'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: '首先，什么是\(\omega_a\)？下标\(a\)代表“分析”；因此，\(\omega_a\)表示一个被探测的单个频率。在此阶段，关于工作流程的快速说明——当我们实际运行小波变换时，这将会变得非常清楚）： '
- en: '* * *'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: A single transform, resulting in spectrogram-like, three-dimensional output,
    operates on a set of analysis frequencies (\(\omega_a\)), and covers the whole
    time range (\(t_n\)).
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 一个单一的变换，产生类似频谱的三维输出，作用于一系列分析频率(\(\omega_a\))，并覆盖整个时间范围(\(t_n\))。
- en: That covering is achieved by having the wavelet slide over the input, its position
    at each step being identified by its center, \(t_k\).
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 这种覆盖是通过让小波在输入上滑动来实现的，其位置在每一步由其中心，\(t_k\)确定。
- en: What’s missing from this characterization is \(K\). That’s because you run a
    separate wavelet analysis for each \(K\) of interest.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 这种描述中缺少的是\(K\)。这是因为你需要为感兴趣的每个\(K\)运行一个单独的小波分析。
- en: '* * *'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: Now, let’s first inspect visually the respective impacts of \(\omega_a\) and
    \(K\) ([fig. 28.2](#fig-wav-K-omega)).
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们首先从视觉上检查\(\omega_a\)和\(K\)的相应影响（[图28.2](#fig-wav-K-omega)）。
- en: '[PRE2]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '*![A 3x3 arrangement of sine waves, squished or spread out in time.](../Images/9313428f0eb8770213a36257ed3a5aec.png)'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: '*![一个3x3的正弦波排列，随时间挤压或展开。](../Images/9313428f0eb8770213a36257ed3a5aec.png)'
- en: 'Figure 28.2: Morlet wavelet: Effects of varying scale and analysis frequency.'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 图28.2：Morlet小波：尺度和分析频率变化的影响。
- en: In the left column, we keep \(\omega_a\) constant, and vary \(K\). On the right,
    \(\omega_a\) changes, and \(K\) stays the same.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 在左列，我们保持 \(\omega_a\) 不变，而改变 \(K\)。在右列，\(\omega_a\) 发生变化，而 \(K\) 保持不变。
- en: Firstly, we observe that the higher \(K\), the more the curve gets spread out.
    In a wavelet analysis, this means that more points in time will contribute to
    the transform’s output, resulting in high precision as to frequency content, but
    loss of resolution in time. (We’ll return to this – central – trade-off soon.)
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们观察到 \(K\) 越高，曲线就越分散。在波小波分析中，这意味着更多的时间点将贡献于变换的输出，从而在频率内容上具有高精度，但在时间上分辨率会降低。（我们很快就会回到这个——核心——权衡。）
- en: As to \(\omega_a\), its impact is twofold. On the one hand, in the Gaussian
    term, it counteracts – *exactly*, even – the scale parameter, \(K\). On the other,
    it determines the frequency, or equivalently, the period, of the wave. To see
    this, take a look at the right column. Corresponding to the different frequencies,
    we have, in the interval between 4 and 6, four, six, or eight peaks, respectively.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 关于 \(\omega_a\)，它的影响有两方面。一方面，在高斯项中，它正好抵消了——甚至——尺度参数 \(K\)。另一方面，它决定了波的频率，或者说，周期。为了理解这一点，请看一下右列。对应不同的频率，在4到6的区间内，我们分别有四个、六个或八个峰值。
- en: This double role of \(\omega_a\) is the reason why, all-in-all, it *does* make
    a difference whether we shrink \(K\), keeping \(\omega_a\) constant, or increase
    \(\omega_a\), holding \(K\) fixed.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: \(\omega_a\) 的这种双重作用是为什么，总的来说，当我们保持 \(\omega_a\) 不变而缩小 \(K\)，或者保持 \(K\) 不变而增加
    \(\omega_a\) 时，这确实会有所不同。
- en: This state of things sounds complicated, but is less problematic than it might
    seem. In practice, understanding the role of \(K\) is important, since we need
    to pick sensible \(K\) values to try. As to the \(\omega_a\), on the other hand,
    there will be a multitude of them, corresponding to the range of frequencies we
    analyze.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 这种情况听起来很复杂，但实际上并没有看起来那么复杂。在实践中，理解 \(K\) 的作用很重要，因为我们需要挑选合理的 \(K\) 值来尝试。至于 \(\omega_a\)，另一方面，将会有许多不同的值，对应于我们分析的频率范围。
- en: 'So we can understand the impact of \(K\) in more detail, we need to take a
    first look at the Wavelet Transform.*  *## 28.3 Wavelet Transform: A straightforward
    implementation'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，为了更详细地了解 \(K\) 的影响，我们需要首先看一下小波变换。*  *## 28.3 小波变换：直接实现
- en: 'While overall, the topic of wavelets is more multifaceted, and thus, may seem
    more enigmatic than Fourier analysis, the transform itself is easier to grasp.
    It is a sequence of local convolutions between wavelet and signal. Here is the
    formula for specific scale parameter \(K\), analysis frequency \(\omega_a\), and
    wavelet location \(t_k\):'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管波小波的主题更加复杂，因此可能比傅里叶分析看起来更加神秘，但变换本身更容易理解。它是一系列小波和信号之间的局部卷积。以下是特定尺度参数 \(K\)、分析频率
    \(\omega_a\) 和小波位置 \(t_k\) 的公式：
- en: \[ W_{K, \omega_a, t_k} = \sum_n x_n \Psi_{\omega_{a},K,t_{k}}^*(t_n) \]
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: \[ W_{K, \omega_a, t_k} = \sum_n x_n \Psi_{\omega_{a},K,t_{k}}^*(t_n) \]
- en: This is just a dot product, computed between signal and complex-conjugated wavelet.
    (Here complex conjugation flips the wavelet in time, making this *convolution*,
    not correlation – a fact that matters a lot, as you’ll see soon.)
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 这只是一个点积，计算的是信号和复共轭小波之间的点积。（在这里，复共轭翻转了小波在时间上的位置，使得这成为*卷积*而不是相关——这是一个非常重要的事实，你很快就会看到。）
- en: Correspondingly, straightforward implementation results in a sequence of dot
    products, each corresponding to a different alignment of wavelet and signal. Below,
    in `wavelet_transform()`, arguments `omega` and `K` are scalars, while `x`, the
    signal, is a vector. The result is the wavelet-transformed signal, for some specific
    `K` and `omega` of interest.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 相应地，直接实现的结果是一系列点积，每个点积对应于小波和信号的不同对齐方式。在下面的 `wavelet_transform()` 函数中，参数 `omega`
    和 `K` 是标量，而 `x`，即信号，是一个向量。结果是针对特定 `K` 和 `omega` 的波变换信号。
- en: '[PRE3]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '*To test this, we generate a simple sine wave that has a frequency of 100 Hertz
    in its first part, and double that in the second ([fig. 28.3](#fig-wav-signal-short)).'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: '*为了测试这一点，我们生成一个简单的正弦波，其第一部分频率为100赫兹，第二部分翻倍（[图28.3](#fig-wav-signal-short)）。'
- en: '[PRE4]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '*![A sine wave that oscillates a lot faster in its second part.](../Images/3e4742dd1af28daef87a7e8b9de4d766.png)'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: '*![一个在第二部分振荡得很快的正弦波。](../Images/3e4742dd1af28daef87a7e8b9de4d766.png)'
- en: 'Figure 28.3: An example signal, consisting of a low-frequency and a high-frequency
    half.'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 图28.3：一个示例信号，由低频和高频两部分组成。
- en: 'Now, we run the Wavelet Transform on this signal, for an analysis frequency
    of 100 Hertz, and with a `K` parameter of 2, found through quick experimentation
    ([fig. 28.4](#fig-wav-signal-short-transform)):'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们对这个信号进行小波变换，分析频率为100赫兹，`K`参数为2，这是通过快速实验得出的([图28.4](#fig-wav-signal-short-transform))：
- en: '[PRE5]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '*![A square wave that starts high, then drops to zero.](../Images/99f153a98f98228474f5883cf01f081a.png)'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: '*![一个开始时为高，然后降至零的方波。](../Images/99f153a98f98228474f5883cf01f081a.png)'
- en: 'Figure 28.4: Wavelet Transform of the above two-part signal. Analysis frequency
    is 100 Hertz.'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 图28.4：上述两部分的信号的波let变换。分析频率为100赫兹。
- en: The transform correctly picks out the part of the signal that matches the analysis
    frequency. If you feel like, you might want to double-check what happens for an
    analysis frequency of 200 Hertz.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 变换正确地提取了与分析频率匹配的信号部分。如果你愿意，你可以检查一下分析频率为200赫兹时会发生什么。
- en: Now, in reality we will want to run this analysis not for a single frequency,
    but a range of frequencies we’re interested in. And we will want to try different
    scales `K`. Now, if you executed the code above, you might be worried that this
    could take a *lot* of time.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，在现实中，我们希望对这个分析不是针对单个频率，而是针对我们感兴趣的频率范围。我们还想尝试不同的`K`尺度。现在，如果你执行了上面的代码，你可能会担心这可能会花费很多时间。
- en: Well, it by necessity takes longer to compute than its Fourier analogue, the
    spectrogram. For one, that’s because with spectrograms, the analysis is “just”
    two-dimensional, the axes being time and frequency. With wavelets there are, in
    addition, different scales to be explored. And secondly, spectrograms operate
    on whole windows (with configurable overlap); a wavelet, on the other hand, slides
    over the signal in unit steps.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 嗯，它必然比其傅里叶类似物频谱图计算时间更长。一方面，这是因为频谱图的分析“只是”二维的，轴是时间和频率。而在小波中，还有不同的尺度需要探索。其次，频谱图在整窗口上操作（具有可配置的重叠）；另一方面，小波在信号上以单位步长滑动。
- en: Still, the situation is not as grave as it sounds. The Wavelet Transform being
    a *convolution*, we can implement it in the Fourier domain instead. We’ll do that
    very soon, but first, as promised, let’s revisit the topic of varying `K`.***  ***##
    28.4 Resolution in time versus in frequency
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管如此，情况并没有听起来那么严重。由于小波变换是一种**卷积**，我们可以在傅里叶域中实现它。我们很快就会这样做，但首先，如承诺的那样，让我们回顾一下`K`变化的主题。***  ***##
    28.4 时间分辨率与频率分辨率
- en: We already saw that the higher `K`, the more spread-out the wavelet. We can
    use our first, maximally straightforward, example, to investigate one immediate
    consequence. What, for example, happens for `K` set to twenty ([fig. 28.5](#fig-wav-signal-short-transform-largeK))?
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经看到，`K`值越高，小波就越分散。我们可以用我们的第一个、最直接简单的例子来调查一个直接后果。例如，当`K`设置为二十时会发生什么([图28.5](#fig-wav-signal-short-transform-largeK))？
- en: '[PRE6]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '*![A sine wave that peaks in the first half of samples, and is mostly zero
    in the second.](../Images/80e145e39c05128e6a3ae0eb4e718f55.png)'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: '*![一个在样本的前半部分达到峰值，而在后半部分主要为零的正弦波。](../Images/80e145e39c05128e6a3ae0eb4e718f55.png)'
- en: 'Figure 28.5: Wavelet Transform of the above two-part signal, with `K` set to
    twenty instead of two.'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 图28.5：将`K`设置为二十而不是二时，上述两部分的信号的波let变换。
- en: The Wavelet Transform still picks out the correct region of the signal – but
    now, instead of a rectangle-like result, we get a significantly smoothed version
    that does not sharply separate the two regions.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 小波变换仍然能够正确地提取信号的相应区域——但现在，我们得到的是一个显著平滑的版本，它没有尖锐地分隔这两个区域。
- en: Notably, the first 0.05 seconds, too, show considerable smoothing. The larger
    a wavelet, the more element-wise products will be lost at the end and the beginning.
    This is because transforms are computed aligning the wavelet at all signal positions,
    from the very first to the last. Concretely, when we compute the dot product at
    location `t_k = 1`, just a single sample of the signal is considered.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 值得注意的是，前0.05秒也显示了相当程度的平滑。小波越大，在开始和结束时丢失的元素乘积就越多。这是因为变换是通过将小波对齐到所有信号位置来计算的，从第一个到最后一个。具体来说，当我们计算位置`t_k
    = 1`处的点积时，只考虑信号的一个样本。
- en: Apart from possibly introducing unreliability at the boundaries, how does wavelet
    scale affect the analysis? Well, since we’re *correlating* (*convolving*, technically;
    but in this case, the effect, in the end, is the same) the wavelet with the signal,
    point-wise similarity is what matters. Concretely, assume the signal is a pure
    sine wave, the wavelet we’re using is a windowed sinusoid like the Morlet, and
    that we’ve found an optimal `K` that nicely captures the signal’s frequency. Then
    any other `K`, be it larger or smaller, will result in less point-wise overlap.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 除了可能在边界处引入不可靠性之外，小波尺度如何影响分析？嗯，因为我们正在*相关*（技术上讲是卷积；但在这个情况下，最终的效果是相同的），所以点对点相似性很重要。具体来说，假设信号是一个纯正弦波，我们使用的小波是一个像Morlet这样的窗口正弦波，并且我们已经找到了一个很好的`K`来捕捉信号的频率。那么任何其他`K`，无论大小，都会导致更少的点对点重叠。
- en: This leads to a question we can’t get around.*  *## 28.5 How is this different
    from a spectrogram?
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 这引发了一个我们无法回避的问题。*  *## 28.5 这与频谱图有何不同？
- en: Chances are you have been mentally comparing what we’re doing here not with
    the Fourier Transform per se, but with its windowed progeny, the spectrogram.
    Both methods tell us how frequency composition varies over time. Both involve
    trade-offs between resolution in frequency and in time. How, then, are they different?
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 很可能你已经在心理上把我们在这里做的事情与傅里叶变换本身进行比较，而不是与其窗口化的后代，即频谱图。两种方法都告诉我们频率成分随时间的变化。两者都涉及频率和时间分辨率之间的权衡。那么，它们有什么不同呢？
- en: Let’s start with the way spectrograms are normally computed. Usually, the choice
    of window size is the same for all frequency ranges. Then, resolution of high
    frequencies will be better than that of lower ones, since more periods fit into
    one analysis window.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从通常如何计算频谱图开始。通常，窗口大小对所有频率范围的选择是相同的。然后，高频的分辨率将优于低频，因为更多的周期可以拟合到一个分析窗口中。
- en: To counteract this, it would be possible to choose different window sizes for
    different ranges of frequencies. But then, how do you make those choices? It is
    a lot more convenient to, in wavelet analysis, experiment with different `K`,
    all the more since with growing experience, those explorations will resemble to
    trial-and-error endeavors less and less.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 为了对抗这一点，我们可以为不同频率范围选择不同的窗口大小。但然后，你如何做出这些选择呢？在波let分析中，实验不同的`K`要方便得多，尤其是随着经验的增长，这些探索将越来越少地像试错过程。
- en: 28.6 Performing the Wavelet Transform in the Fourier domain
  id: totrans-68
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 28.6 在傅里叶域执行小波变换
- en: 'Soon, we will run the Wavelet Transform on a longer signal. Thus, it is time
    to speed up computation. We already said that here, we benefit from time-domain
    convolution being equivalent to multiplication in the Fourier domain. The overall
    process then is this: First, compute the DFT of both signal and wavelet; second,
    multiply the results; third, inverse-transform back to the time domain.'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 很快，我们将对更长的信号运行小波变换。因此，现在是时候加快计算速度了。我们之前已经说过，在这里，我们受益于时域卷积在傅里叶域中等同于乘法。整个过程是这样的：首先，计算信号和小波的DFT；其次，乘以结果；第三，逆变换回到时域。
- en: 'With the Morlet wavelet, we don’t even have to run the FFT: Its Fourier-domain
    representation can be stated in closed form. We’ll just make use of that formulation
    from the outset.'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Morlet小波，我们甚至不需要运行FFT：其傅里叶域表示可以用闭式形式表示。我们将从一开始就利用这个公式。
- en: To see how this works, we first manually step through the process. In the following
    section, we’ll package things up for quick execution.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 为了看到这是如何工作的，我们首先手动逐步通过这个过程。在下一节中，我们将把事情打包起来以便快速执行。
- en: 'Here, first, is the signal. It again is composed of two different frequencies,
    100 Hertz and 200 Hertz. But this time, we repeat the alternation several times,
    and map those frequencies to different amplitudes. The latter may seem like an
    innocent change, but there is an important consequence: We have to adapt our cosine-generating
    code to keep track of the phase. If we don’t do this, the signal will be distorted
    at the transition points.'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 这里，首先，是信号。它再次由两个不同的频率组成，100赫兹和200赫兹。但这次，我们重复交替几次，并将这些频率映射到不同的振幅。后者可能看起来是无害的改变，但有一个重要的后果：我们必须调整我们的余弦生成代码来跟踪相位。如果我们不这样做，信号将在过渡点被扭曲。
- en: '[PRE7]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '*Here is the signal ([fig. 28.6](#fig-wav-signal-long)):'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: '*以下是信号 ([图28.6](#fig-wav-signal-long))：'
- en: '[PRE8]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '*![A sine wave that alternates between different frequencies and amplitudes.](../Images/43b8b9377f31208f94a902c99fcb2ac1.png)'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: '*![在交替不同频率和幅度的正弦波。](../Images/43b8b9377f31208f94a902c99fcb2ac1.png)'
- en: 'Figure 28.6: A signal, consisting of alternating, different-amplitude low-frequency
    and high-frequency halves.'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 图28.6：一个由交替、不同幅度低频和高频部分组成的信号。
- en: 'The DFT of the signal is quickly computed:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 信号的DFT很快就被计算出来：
- en: '[PRE9]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '*The Fourier-domain representation of the wavelet, on the other hand, is given
    by:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: '*波let的傅里叶域表示由以下给出：'
- en: '[PRE10]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '*Comparing this statement of the wavelet to the time-domain one, we see that
    – as expected – instead of parameters `t` and `t_k` it now takes `omega` and `omega_a`.
    The latter, `omega_a`, is the analysis frequency, the one we’re probing for, a
    scalar; the former, `omega`, the range of frequencies that appear in the DFT of
    the signal.'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: '*将这个波let的陈述与时域陈述进行比较，我们看到——正如预期的那样——现在它使用的是参数`omega`和`omega_a`，而不是`t`和`t_k`。后者`omega_a`是分析频率，我们正在探测的标量；前者`omega`是信号DFT中出现的频率范围。'
- en: 'In instantiating the wavelet, there is one thing we need to pay special attention
    to. In FFT-think, the frequencies are bins; their number is determined by the
    length of the signal (a length that, for its part, directly depends on sampling
    frequency). Our wavelet, on the other hand, works with frequencies in Hertz (nicely,
    from a user’s perspective; since this unit is meaningful to us). What this means
    is that to `morlet_fourier`, as `omega_a` we need to pass not the value in Hertz,
    but the corresponding FFT bin. Conversion is done relating the number of bins,
    `dim(x)[1]`, to the sampling frequency of the signal, `fs`:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 在实例化小波时，有一件事我们需要特别注意。在FFT思维中，频率是桶；它们的数量由信号的长度（这个长度，从其本身来说，直接依赖于采样频率）决定。另一方面，我们的波let使用赫兹频率（从用户的角度来看，这是一个很好的单位；因为这个单位对我们来说是有意义的）。这意味着对于`morlet_fourier`，作为`omega_a`，我们需要传递的不是赫兹值，而是相应的FFT桶。转换是通过将桶的数量，`dim(x)[1]`，与信号的采样频率`fs`相关联来完成的：
- en: '[PRE11]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '*We instantiate the wavelet, perform the Fourier-domain multiplication, and
    inverse-transform the result:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: '*我们实例化波let，执行傅里叶域乘法，并对结果进行逆变换：'
- en: '[PRE12]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '*And this is the result ([fig. 28.7](#fig-wav-example-long-transform)):'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: '*这是结果 ([图28.7](#fig-wav-example-long-transform))：'
- en: '[PRE13]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '*![An alternating square wave.](../Images/e21d56060b4ac862367957e8c361a9f8.png)'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: '*![交替的方波。](../Images/e21d56060b4ac862367957e8c361a9f8.png)'
- en: 'Figure 28.7: Wavelet Transform of the above alternating-frequency signal. Analysis
    frequency is 100 Hertz.'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 图28.7：上述交替频率信号的波let变换。分析频率为100赫兹。
- en: All 100-Hertz-regions are identified flawlessly. Also, looking at the y-axis,
    we see that the amplitude is correct.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 所有100赫兹区域都被完美地识别。此外，从y轴来看，我们看到幅度是正确的。
- en: Putting together wavelet instantiation and the steps involved in the analysis,
    we have the following. (Note how to `wavelet_transform_fourier`, we now, conveniently,
    pass in the frequency value in Hertz.)
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 将小波实例化和分析涉及的步骤结合起来，我们得到以下内容。（注意现在如何`wavelet_transform_fourier`，我们方便地传递了赫兹频率值。）
- en: '[PRE14]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '*Let’s use this to probe for the second frequency used, 200 Hertz ([fig. 28.8](#fig-wav-example-long-transform2)).'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: '*让我们用这个来探测第二个使用的频率，200赫兹 ([图28.8](#fig-wav-example-long-transform2))。'
- en: '[PRE15]'
  id: totrans-95
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '*![An alternating square wave.](../Images/25ba40802be36a7559c3ba4873167c7e.png)'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: '*![交替的方波。](../Images/25ba40802be36a7559c3ba4873167c7e.png)'
- en: 'Figure 28.8: Wavelet Transform of the above alternating-frequency signal. Analysis
    frequency is 200 Hertz.'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 图28.8：上述交替频率信号的波let变换。分析频率为200赫兹。
- en: Again, we find that matching regions, as well as the amplitude, are correctly
    identified.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 再次，我们发现匹配区域以及幅度都被正确地识别了。
- en: 'We’ve already made significant progress. We’re ready for the final step: automating
    analysis over a range of frequencies of interest. This will result in a three-dimensional
    representation, the wavelet diagram.*********  ***## 28.7 Creating the wavelet
    diagram'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经取得了显著的进展。我们现在准备进行最后一步：对感兴趣频率范围内的分析进行自动化。这将导致一个三维表示，即小波图。*********  ***28.7
    创建小波图
- en: In the Fourier Transform, the number of coefficients we obtain depends on signal
    length, and effectively reduces to half the sampling frequency. With its wavelet
    analogue, since anyway we’re doing a loop over frequencies, we might as well decide
    which frequencies to analyze.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 在傅里叶变换中，我们获得的系数数量取决于信号长度，实际上减少到采样频率的一半。与其波let类似，因为我们无论如何都在对频率进行循环，我们不妨决定要分析哪些频率。
- en: Firstly, the range of frequencies of interest can be determined running the
    DFT. The next question, then, is about granularity. Here, I’ll be following the
    recommendation given in Vistnes’ book, which is based on the relation between
    current frequency value and wavelet scale, `K`.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，通过运行 DFT 可以确定感兴趣的频率范围。接下来，问题是关于粒度。在这里，我将遵循 Vistnes 书中给出的建议，该建议基于当前频率值与小波尺度
    `K` 之间的关系。
- en: 'Iteration over frequencies is then implemented as a loop:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 频率的迭代通过循环实现：
- en: '[PRE16]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '*Calling `wavelet_grid()` will give us the analysis frequencies used, together
    with the respective outputs from the Wavelet Transform.'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: '*调用 `wavelet_grid()` 将会给我们分析频率以及相应的 Wavelet 变换输出。'
- en: Next, we create a utility function that visualizes the result. By default, `plot_wavelet_diagram()`
    displays the magnitude of the wavelet-transformed series; it can, however, plot
    the squared magnitudes, too, as well as their square root, a method much recommended
    by Vistnes whose effectiveness we will soon have opportunity to witness.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们创建一个可视化结果的实用函数。默认情况下，`plot_wavelet_diagram()` 显示小波变换序列的幅度；然而，它也可以绘制平方幅度，以及它们的平方根，这是一种由
    Vistnes 非常推荐的方法，我们很快就能看到其有效性。
- en: The function deserves a few further comments.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 这个函数值得进一步讨论。
- en: Firstly, same as we did with the analysis frequencies, we down-sample the signal
    itself, avoiding to suggest a resolution that is not actually present. The formula,
    again, is taken from Vistnes’ book.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，就像我们对分析频率所做的那样，我们对信号本身进行下采样，避免提出一个实际上并不存在的分辨率。公式再次来自 Vistnes 的书。
- en: Then, we use interpolation to obtain a new time-frequency grid. This step may
    even be necessary if we keep the original grid, since when distances between grid
    points are very small, R’s `image()` may refuse to accept axes as evenly spaced.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们使用插值来获得新的时频网格。如果我们保持原始网格，这一步甚至可能是必要的，因为当网格点之间的距离非常小的时候，R 的 `image()` 函数可能会拒绝接受等间距的轴。
- en: Finally, note how frequencies are arranged on a log scale. This leads to much
    more useful visualizations.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，注意频率是如何以对数尺度排列的。这导致了许多更有用的可视化效果。
- en: '[PRE17]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '*Now, let’s see a few wavelet diagrams. We are going to compare choices in
    two categories. The first concerns *what* is displayed: magnitude, magnitude squared,
    or the square root. Since options are finite, in practice you could always try
    them all. The second, however, is essential: It is about `K`, the scale of the
    Morlet wavelet.'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: '*现在，让我们看看几个波let 图。我们将比较两个类别的选择。第一个是关于 *显示什么*：幅度、幅度平方还是平方根。由于选项有限，实际上你可以尝试所有这些。然而，第二个是至关重要的：它是关于
    `K`，即 Morlet 小波的尺度。'
- en: Though, in theory, the range of possible `K`s is infinite, as soon as we start
    to enlarge or shrink `K` we see the respective effects very quickly. And in a
    publication you can, of course, provide diagrams for a few different `K`. (Maybe
    you even *should*; the information conveyed might be complementary.)
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然在理论上可能的 `K` 值范围是无限的，但当我们开始增大或缩小 `K` 时，我们会很快看到相应的影响。在出版物中，你当然可以提供几个不同 `K` 的图表。（也许你甚至应该这样做；传达的信息可能是互补的。）
- en: We start with a fixed `K` of 12, and stay with the default display (which is
    magnitude; see [fig. 28.9](#fig-wav-example-long-diag1)). As to the range of frequencies
    to be analysed, it directly follows from our having generated the data ourselves.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 我们从一个固定的 `K` 值 12 开始，并保持默认显示（即幅度；参见 [图 28.9](#fig-wav-example-long-diag1)）。至于要分析的频率范围，它直接来源于我们自行生成数据。
- en: '[PRE18]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '*![A periodic square wave drawn in thick strokes.](../Images/f06f61690045e6a59f5c59cb8fe6fdce.png)'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: '*![用粗线绘制的周期性方波。](../Images/f06f61690045e6a59f5c59cb8fe6fdce.png)'
- en: 'Figure 28.9: Wavelet diagram of the above alternating-frequency signal for
    K = 12\. Displaying magnitude as per default.'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 图 28.9：对于 K = 12 的上述交替频率信号的波let 图。默认显示幅度。
- en: Now compare this with how it looks for squared magnitudes ([fig. 28.10](#fig-wav-example-long-diag2)).
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 现在比较一下平方幅度的情况（[图 28.10](#fig-wav-example-long-diag2)）。
- en: '[PRE19]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '*![A periodic alternation of two thick-ish dashed lines.](../Images/c080ef43711c687276f750808e4d1945.png)'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: '*![两条粗略的虚线周期性交替。](../Images/c080ef43711c687276f750808e4d1945.png)'
- en: 'Figure 28.10: Wavelet diagram of the above alternating-frequency signal for
    K = 12\. Displaying magnitude squared.'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 图 28.10：对于 K = 12 的上述交替频率信号的波let 图。显示幅度平方。
- en: 'As well as square roots ([fig. 28.11](#fig-wav-example-long-diag3)):'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 以及平方根（[图 28.11](#fig-wav-example-long-diag3)）：
- en: '[PRE20]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: '*![A periodic square wave drawn in thick, bulky strokes.](../Images/0a49c3e11efe3296426afbd66e72225d.png)'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: '*![用粗重的笔触绘制的周期性方波。](../Images/0a49c3e11efe3296426afbd66e72225d.png)'
- en: 'Figure 28.11: Wavelet diagram of the above alternating-frequency signal for
    K = 12\. Displaying the square root of the magnitude.'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 图28.11：上述交替频率信号的波形图，显示幅度平方根。
- en: In this case it is clear which display mode works best. But that’s just because
    we’ve created a *very* regular signal.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，哪种显示模式效果最好是很明显的。但这仅仅是因为我们创建了一个非常规则的信号。
- en: 'Now, let’s see what happens for smaller `K`: 6, say. We only plot magnitude
    squared ([fig. 28.12](#fig-wav-example-long-diag4)).'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们看看对于较小的`K`会发生什么：比如说6。我们只绘制了幅度平方([图28.12](#fig-wav-example-long-diag4))。
- en: '[PRE21]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '*![A periodic alternation of two thick dashed lines.](../Images/3ca25b934572274acf14cd889bae8f97.png)'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: '*![两条较粗的虚线周期性地交替。](../Images/3ca25b934572274acf14cd889bae8f97.png)'
- en: 'Figure 28.12: Wavelet diagram of the above alternating-frequency signal for
    K = 6.'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 图28.12：频率为K = 6的上述交替频率信号的波形图。
- en: While frequency resolution clearly got worse, there is no complementary improvement
    in how time is handled. Again, this is no surprise, the signal being what it is.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然频率分辨率明显变差，但在处理时间方面并没有相应的改进。再次强调，这并不令人惊讶，因为信号本身就是这样的。
- en: 'What about the other direction? For `K = 24` we have ([fig. 28.13](#fig-wav-example-long-diag5)):'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 那么其他方向呢？对于`K = 24`，我们有([图28.13](#fig-wav-example-long-diag5))：
- en: '[PRE22]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: '*![A periodic, overlapping alternation of two not-too-thick dashed lines.](../Images/f728f680dc806c63521759db44fc4284.png)'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: '*![两条不太粗的虚线周期性地重叠交替。](../Images/f728f680dc806c63521759db44fc4284.png)'
- en: 'Figure 28.13: Wavelet diagram of the above alternating-frequency signal for
    K = 24.'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 图28.13：频率为K = 24的上述交替频率信号的波形图。
- en: At this scale, we do see a decline in time resolution. Evidently, our initial
    choice of 12 was better. Just for curiosity’s sake, though, let’s see what would
    happen for yet bigger `K` ([fig. 28.14](#fig-wav-example-long-diag6)).
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个尺度上，我们确实看到了时间分辨率的下降。显然，我们最初选择的12是更好的选择。不过，出于好奇，让我们看看对于更大的`K`（[图28.14](#fig-wav-example-long-diag6)）会发生什么。
- en: '[PRE23]'
  id: totrans-136
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: '*![A dashed line, in the upper area of the image, and a solid line further
    down, that exhibits holes of sorts in the places where the dashed line appears.](../Images/4af4cd5388436413b7e6c0909463f8e8.png)'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: '*![图像上部的虚线，以及更下方的实线，在虚线出现的地方显示出类似孔洞的形状。](../Images/4af4cd5388436413b7e6c0909463f8e8.png)'
- en: 'Figure 28.14: Wavelet diagram of the above alternating-frequency signal for
    K = 48.'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 图28.14：频率为K = 48的上述交替频率信号的波形图。
- en: The result speaks for itself.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 结果不言自明。
- en: 'Finally – now that we have available re-usable pieces of code, and acquired
    some first intuition on how time-frequency trade-off works for wavelets – we conclude
    with a real-world example.********  ***## 28.8 A real-world example: Chaffinch’s
    song'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 最后——现在我们有了可重用的代码片段，并对小波的时间-频率权衡有了初步的了解——我们用一个实际例子来总结。********  ***## 28.8 一个现实世界的例子：麻雀的歌声
- en: For the case study, I’ve chosen what, to me, was the most impressive wavelet
    analysis shown in Vistnes’ book. It’s a sample of a chaffinch’s singing, and it’s
    available on Vistnes’ website.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 对于案例研究，我选择了在我看来是Vistnes书中最令人印象深刻的波形分析。这是一只麻雀唱歌的样本，可以在Vistnes的网站上找到。
- en: '[PRE24]'
  id: totrans-142
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: '*We use `torchaudio` to load the file, and convert from stereo to mono using
    `tuneR`’s appropriately named `mono()`. (For the kind of analysis we’re doing,
    there is no point in keeping two channels around.)'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: '*我们使用 `torchaudio` 来加载文件，并使用 `tuneR` 的 `mono()` 函数将立体声转换为单声道。（对于我们所做的这种分析，保留两个通道是没有意义的。）'
- en: '[PRE25]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: '*[PRE26]'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: '*[PRE26]'
- en: For analysis, we don’t need the complete sequence. Helpfully, Vistnes also published
    a recommendation as to which range of samples to analyze.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 对于分析，我们不需要完整的序列。方便的是，Vistnes 还发布了一项建议，说明应该分析哪些样本范围。
- en: '[PRE27]'
  id: totrans-147
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: '*[PRE28]'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: '*[PRE28]'
- en: See [fig. 28.15](#fig-wav-chaffinch) for a time-domain view. (Don’t miss out
    on the occasion to actually *listen* to it, on your laptop.)
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 见[图28.15](#fig-wav-chaffinch)以查看时域视图。（不要错过在您的笔记本电脑上实际*聆听*它的机会。）
- en: '[PRE29]'
  id: totrans-150
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: '*![A sequence of several bursts, varying in height and thickness.](../Images/e8c6153a4332b63c0a8a44d0a2d7ba82.png)'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: '*![一系列高度和厚度不同的脉冲。](../Images/e8c6153a4332b63c0a8a44d0a2d7ba82.png)'
- en: 'Figure 28.15: Chaffinch’s song.'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 图28.15：麻雀的歌声。
- en: 'Now, we need to determine a reasonable range of analysis frequencies. To that
    end, we run the FFT:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们需要确定一个合理的分析频率范围。为此，我们运行FFT：
- en: '[PRE30]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: '*On the x-axis, we plot frequencies, not sample numbers, and for better visibility,
    we zoom in a bit ([fig. 28.16](#fig-wav-chaffinch-fft)).'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: '*在x轴上，我们绘制频率，而不是样本数，为了更好的可见性，我们稍微放大了一些([图28.16](#fig-wav-chaffinch-fft))。'
- en: '[PRE31]'
  id: totrans-156
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: '*![A sequence of spikes, skewed to the left.](../Images/01dc6f1a6e241e0ee3730c38f73932ee.png)'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: '*![一系列向左偏斜的尖峰。](../Images/01dc6f1a6e241e0ee3730c38f73932ee.png)'
- en: 'Figure 28.16: Chaffinch’s song, Fourier spectrum (excerpt).'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 图28.16：金翅雀的歌声，傅里叶频谱（摘录）。
- en: Based on this distribution, we can safely restrict the range of analysis frequencies
    to between, approximately, 1800 and 8500 Hertz. (This is also the range recommended
    by Vistnes.)
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 基于这个分布，我们可以安全地将分析频率的范围限制在大约1800到8500赫兹之间。（这也是Vistnes推荐的范围。）
- en: First, though, let’s anchor expectations by creating a spectrogram for this
    signal. Suitable values for FFT size and window size were found experimentally.
    And though, in spectrograms, you don’t see this done often, I found that displaying
    square roots of coefficient magnitudes yielded the most informative output.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，让我们通过为这个信号创建一个频谱图来锚定期望。通过实验找到了FFT大小和窗口大小的合适值。尽管在频谱图中不常看到这样做，但我发现显示系数幅度的平方根可以产生最有信息量的输出。
- en: '[PRE32]'
  id: totrans-161
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: '*[PRE33]'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: '*[PRE33]'
- en: Like we do with wavelet diagrams, we plot frequencies on a log scale ([fig. 28.17](#fig-wav-chaffinch-spectrogram)).
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 就像我们在小波图中做的那样，我们在对数尺度上绘制频率（[图28.17](#fig-wav-chaffinch-spectrogram)）。
- en: '[PRE34]'
  id: totrans-164
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: '*![A two-dimensional heat map, indicating high values, strongly varying in
    time, around log frequency 3.5 Hz.](../Images/565dac528265308492f874f45edeacc2.png)'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: '*![一个在3.5赫兹对数频率周围，高值且随时间强烈变化的两维热图。](../Images/565dac528265308492f874f45edeacc2.png)'
- en: 'Figure 28.17: Chaffinch’s song, spectrogram.'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 图28.17：金翅雀的歌声，频谱图。
- en: 'The spectrogram already shows a distinctive pattern. Let’s see what can be
    done with wavelet analysis. Having experimented with a few different `K`, I agree
    with Vistnes that `K = 48` makes for an excellent choice ([fig. 28.18](#fig-wav-chaffinch-waveletdiag)):'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 频谱图已经显示出一种独特的模式。让我们看看小波分析能做什么。经过对几个不同的`K`值进行实验，我同意Vistnes的观点，`K = 48`是一个非常好的选择（[图28.18](#fig-wav-chaffinch-waveletdiag)）。
- en: '[PRE35]'
  id: totrans-168
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: '*![A two-dimensional heat map, of high resolution, that strongly emphasizes
    how patterns vary in time.](../Images/0725c98f3ccfa04c64410feaf0d92163.png)'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: '*![一个高分辨率的两维热图，强烈强调了模式随时间的变化。](../Images/0725c98f3ccfa04c64410feaf0d92163.png)'
- en: 'Figure 28.18: Chaffinch’s song, wavelet diagram.'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 图28.18：金翅雀的歌声，小波图。
- en: The gain in resolution, on both the time and the frequency axis, is utterly
    impressive.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 在时间和频率轴上的分辨率提升非常令人印象深刻。
- en: With this example, that hopefully has been an inspiring one, I conclude this
    chapter, and the book. I wish you all the best in your future endeavours with
    `torch`!
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 通过这个例子，希望它能够激发灵感，我结束了这一章，以及整本书。我祝愿你们在未来的`torch`探索中一切顺利！
- en: Vistnes, Arnt Inge. 2018\. *Physics of Oscillations and Waves. With Use of Matlab
    and Python*. Springer.********* **** * *
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: Vistnes, Arnt Inge. 2018\. *振荡和波动的物理. 使用Matlab和Python*. Springer.********* ****
    * *
- en: After Dennis Gabor, who came up with the idea of using Gaussian-windowed complex
    exponentials for time-frequency decomposition, and Jean Morlet, who elaborated
    on and formalized the resulting transform.[↩︎](#fnref1)****************
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Dennis Gabor提出使用高斯窗复指数进行时频分解的想法之后，以及Jean Morlet对结果进行阐述和形式化之后。[↩︎](#fnref1)****************
