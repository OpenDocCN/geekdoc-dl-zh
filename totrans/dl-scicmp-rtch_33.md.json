["```r\nlibrary(torch)\nlibrary(ggplot2)\nlibrary(patchwork)\n\nN <- 64\nsample_positions <- 0:(N - 1)\n\nfrequency <- function(k, N) {\n (2 * pi / N) * k\n}\n\nx <- torch_cos(frequency(1, N) * sample_positions)\n```", "```r\ndf <- data.frame(x = sample_positions, y = as.numeric(x))\n\nggplot(df, aes(x = x, y = y)) +\n geom_line() +\n xlab(\"time\") +\n ylab(\"amplitude\") +\n theme_minimal()\n```", "```r\nFt <- torch_fft_fft(x)\n```", "```r\nreal_part <- Ft$real\nas.numeric(real_part) %>% round(5)\n```", "```r\n[1]  0 32 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n[29] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n[57] 0 0 0 0 0 0 0 32\n```", "```r\nimag_part <- Ft$imag\nas.numeric(imag_part) %>% round(5)\n```", "```r\n[1]  0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n[29] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n[57] 0 0 0 0 0 0 0 0\n```", "```r\nmagnitude <- torch_abs(Ft)\nas.numeric(magnitude) %>% round(5)\n```", "```r\n[1]  0 32 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n[29] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n[57] 0 0 0 0 0 0 0 32\n```", "```r\nphase <- function(Ft, threshold = 1e5) {\n torch_atan2(\n torch_abs(torch_round(Ft$imag * threshold)),\n torch_abs(torch_round(Ft$real * threshold))\n )\n}\n\nas.numeric(phase(Ft)) %>% round(5)\n```", "```r\n[1]  0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n[29] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n[57] 0 0 0 0 0 0 0 0\n```", "```r\ncreate_plot <- function(x, y, quantity) {\n df <- data.frame(\n x_ = x,\n y_ = as.numeric(y) %>% round(5)\n )\n ggplot(df, aes(x = x_, y = y_)) +\n geom_col() +\n xlab(\"frequency\") +\n ylab(quantity) +\n theme_minimal()\n}\n\np_real <- create_plot(\n sample_positions,\n real_part,\n \"real part\"\n)\np_imag <- create_plot(\n sample_positions,\n imag_part,\n \"imaginary part\"\n)\np_magnitude <- create_plot(\n sample_positions,\n magnitude,\n \"magnitude\"\n)\np_phase <- create_plot(\n sample_positions,\n phase(Ft),\n \"phase\"\n)\n\np_real + p_imag + p_magnitude + p_phase\n```", "```r\nx <- torch_cos(frequency(4, N) * sample_positions)\n\nplot_ft <- function(x) {\n\n df <- data.frame(x = sample_positions, y = as.numeric(x))\n p_signal <- ggplot(df, aes(x = x, y = y)) +\n geom_line() +\n xlab(\"time\") +\n ylab(\"amplitude\") +\n theme_minimal()\n\n # in the code, I'm using Ft instead of X because not\n # all operating systems treat variables as case-sensitive\n Ft <- torch_fft_fft(x)\n\n p_real <- create_plot(\n sample_positions,\n Ft$real,\n \"real part\"\n )\n p_imag <- create_plot(\n sample_positions,\n Ft$imag,\n \"imaginary part\"\n )\n p_magnitude <- create_plot(\n sample_positions,\n torch_abs(Ft),\n \"magnitude\"\n )\n p_phase <- create_plot(\n sample_positions,\n phase(Ft),\n \"phase\"\n )\n\n (p_signal | plot_spacer()) /\n (p_real | p_imag) /\n (p_magnitude | p_phase)\n}\n\nplot_ft(x)\n```", "```r\nx <- torch_cos(frequency(32, N) * sample_positions)\nplot_ft(x)\n```", "```r\nx <- 2 * torch_cos(frequency(4, N) * sample_positions)\nplot_ft(x)\n```", "```r\nx <- torch_cos(frequency(4, N) * sample_positions - pi / 2)\n\nplot_ft(x)\n```", "```r\nx <- 3 * torch_sin(frequency(4, N) * sample_positions) +\n 6 * torch_cos(frequency(2, N) * sample_positions) +\n 2 * torch_cos(frequency(8, N) * sample_positions)\n\nplot_ft(x)\n```", "```r\ndft <- function(x) {\n n_samples <- length(x)\n\n n <- torch_arange(0, n_samples - 1)$unsqueeze(1)\n\n Ft <- torch_complex(\n torch_zeros(n_samples), torch_zeros(n_samples)\n )\n\n for (k in 0:(n_samples - 1)) {\n w_k <- torch_exp(-1i * 2 * pi / n_samples * k * n)\n dot <- torch_matmul(w_k, x$to(dtype = torch_cfloat()))\n Ft[k + 1] <- dot\n }\n Ft\n}\n```", "```r\nFt <- dft(x)\ntorch_round(Ft$real) %>% as.numeric()\ntorch_round(Ft$imag) %>% as.numeric()\n```", "```r\n[1]  0 0 192 0 0 0 0 0 64 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n[29] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n[57] 64 0 0 0 0 0 192 0\n\n[1]  0 0 0 0 -96 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n[29] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n[57] 0 0 0 0 96 0 0 0\n```", "```r\ndft_vec <- function(x) {\n n_samples <- length(x)\n\n n <- torch_arange(0, n_samples - 1)$unsqueeze(1)\n k <- torch_arange(0, n_samples - 1)$unsqueeze(2)\n\n mat_k_m <- torch_exp(-1i * 2 * pi / n_samples * k * n)\n\n torch_matmul(mat_k_m, x$to(dtype = torch_cfloat()))\n}\n```", "```r\nsox --combine concatenate \\\n \"|sox -r 4000 -n -p synth 0.2 \\\n sine 941 sine 1336 pinknoise remix -\" \\\n \"|sox -r 4000 -n -p synth 0.2 \\\n sine 852 sine 1336 pinknoise remix - pad 0.15 0.15\" \\\n \"|sox -r 4000 -n -p synth 0.2 \\\n sine 852 sine 1477 pinknoise remix -\" \\\n resources/dft-dial.wav\n```", "```r\nsox resources/dial.wav -n spectrogram \\ \n -m -l -w kaiser -o dial-spectrogram.png\n```", "```r\nlibrary(torchaudio)\n\nwav <- tuneR_loader(\"resources/dft-dial.wav\")\nwav\n```", "```r\nWaveMC Object\n  Number of Samples:      3600\n  Duration (seconds):     0.9\n  Samplingrate (Hertz):   4000\n  Number of channels:     1\n  PCM (integer format):   TRUE\n  Bit (8/16/24/32/64):    32\n```", "```r\nwaveform_and_sample_rate <- transform_to_tensor(wav)\nwaveform <- waveform_and_sample_rate[[1]]\nsample_rate <- waveform_and_sample_rate[[2]]\n\ndim(waveform)\n```", "```r\n[1]    1 3600\n```", "```r\ndf <- data.frame(\n x = 1:dim(waveform)[2],\n y = as.numeric(waveform$squeeze(1))\n)\nggplot(df, aes(x = x, y = y)) +\n geom_line() +\n xlab(\"time\") +\n ylab(\"amplitude\") +\n theme_minimal()\n```", "```r\nnum_samples <- dim(waveform)[2]\nnyquist_cutoff <- num_samples / 2 + 1\nbins_below_nyquist <- 1:nyquist_cutoff\n\nfrequencies_per_bin <- sample_rate / num_samples\nreal_world_frequencies <- frequencies_per_bin *\n bins_below_nyquist\n```", "```r\ndial_fft <- torch_fft_fft(waveform)$squeeze()\n\np_magnitude <- create_plot(\n real_world_frequencies,\n torch_abs(dial_fft)[1:nyquist_cutoff], \"magnitude\"\n)\n\np_magnitude\n```", "```r\ndial_dft <- dft(waveform$squeeze())\n\np_magnitude <- create_plot(\n real_world_frequencies,\n torch_abs(dial_fft)[1:nyquist_cutoff], \"magnitude\"\n)\n\np_magnitude\n```", "```r\nreconstructed <- torch_fft_ifft(dial_dft)\ndf <- data.frame(\n x = 1:num_samples,\n y = as.numeric(reconstructed$real)\n)\n\nggplot(df, aes(x = x, y = y)) +\n geom_line() +\n xlab(\"time\") +\n ylab(\"amplitude\") +\n theme_minimal()\n```"]