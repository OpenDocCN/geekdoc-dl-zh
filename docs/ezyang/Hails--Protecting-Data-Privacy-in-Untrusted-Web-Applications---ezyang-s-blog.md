<!--yml

category: 未分类

date: 2024-07-01 18:17:25

-->

# Hails: 在不受信任的 Web 应用程序中保护数据隐私：ezyang's 博客

> 来源：[`blog.ezyang.com/2012/10/hails-protecting-data-privacy-in-untrusted-web-applications/`](http://blog.ezyang.com/2012/10/hails-protecting-data-privacy-in-untrusted-web-applications/)

*这篇文章是从 Deian Stefan 在 OSDI 2012 上为 Hails 发表的演讲改编而来。*

它是一个广为人知的真理，任何网站（例如 Facebook）都渴望一个 Web 平台（例如 Facebook API）。Web 平台是*很棒的*，因为它们允许第三方开发者构建能够操作我们个人数据的应用程序。

但 Web 平台也是*可怕的*。毕竟，它们允许*第三方*开发者构建能够操作我们*个人*数据的应用程序。据我们所知，他们可能会将我们的电子邮件地址出售给垃圾邮件发送者或窥探我们的个人消息。随着第三方应用程序的普及，窃取个人数据几乎变得微不足道。即使我们假设所有开发者都抱着最好的意图，我们仍然必须担心那些不理解（或不关心）安全性的开发者。

当这些第三方应用程序存在于不受信任的服务器上时，我们无能为力：一旦信息泄露，第三方就可以随心所欲地做任何事情。为了减轻这种情况，像 Facebook 这样的平台采用了 CYA（“自我保护”）的方法：

Hails 项目的论点是我们可以做得更好。以下是如何实现的：

首先，第三方应用程序必须托管在一个受信任的运行时上，以便我们可以在软件中强制执行安全策略。至少，这意味着我们需要一种机制来运行不受信任的代码，并公开受信任的 API，例如数据库访问。Hails 使用[Safe Haskell](http://www.haskell.org/ghc/docs/latest/html/users_guide/safe-haskell.html)来实现和强制执行这样的 API。

接下来，我们需要一种方法在我们信任的运行时中指定安全策略。Hails 观察到大多数数据模型在相关对象中都内置了所有权信息。因此，一个策略可以被表示为一个对文档到可读人员标签集合和可写人员标签集合的函数。例如，“只有珍的朋友可以看她的邮箱地址”这个策略是一个函数，它接受一个代表用户的文档，并将文档的“朋友”字段作为有效读者的集合返回。我们称之为应用的 MP，因为它结合了模型和策略，并且我们提供了一个 DSL 来指定策略。策略往往非常简洁，更重要的是集中在一个地方，而不是散布在代码库中的多个条件语句中。

最后，即使在运行不受信任的代码时，我们也需要一种强制执行这些安全策略的方法。Hails 通过实现线程级动态信息流控制来实现这一点，利用 Haskell 的可编程分号来跟踪和执行信息流。如果第三方应用试图与 Bob 共享一些数据，但这些数据未标记为 Bob 可读取，运行时将引发异常。这种功能被称为[LIO（标记输入输出）](http://hackage.haskell.org/package/lio)，建立在 Safe Haskell 之上。

第三方应用运行在这三种机制之上，实现 Web 应用程序的视图和控制器（VC）组件。这些组件是完全不受信任的：即使它们存在安全漏洞或者是恶意的，运行时也会阻止它们泄露私人信息。您根本不需要考虑安全问题！这使得我们的系统甚至适合用于实现官方 VC。

我们开发的一个示例应用是[GitStar](http://www.gitstar.com/)，一个类似 GitHub 的 Git 项目托管网站。其主要区别在于，GitStar 的几乎所有功能都是通过第三方应用实现的，包括项目和用户管理、代码查看和 wiki。GitStar 仅仅为项目和用户提供了 MPs（模型策略）。其余组件都是不受信任的。

当前的 Web 平台让用户在功能和隐私之间做选择。Hails 让你两者兼得。Hails 已经成熟到可以在实际系统中使用；请访问[`www.gitstar.com/scs/hails`](http://www.gitstar.com/scs/hails)，或直接`cabal install hails`查看。
