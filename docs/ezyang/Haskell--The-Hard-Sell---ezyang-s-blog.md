<!--yml

category: 未分类

date: 2024-07-01 18:18:25

-->

# Haskell, The Hard Sell : ezyang 的博客

> 来源：[`blog.ezyang.com/2010/03/haskell-the-hard-sell/`](http://blog.ezyang.com/2010/03/haskell-the-hard-sell/)

## Haskell, The Hard Sell

上周我谈到了我们如何用等效的 Haskell 代码替换了一个小 C 程序。[这里](http://blog.ezyang.com/2010/03/replacing-small-c-programs-with-haskell/)。尽管我很想说我们部署了代码，有很多欢呼和客户端缓存，但实际情况比这复杂得多。我们需要考虑一些非常好的问题：

1.  *在任何特定时间，有多少维护者知道这种语言？* [Scripts](http://scripts.mit.edu) 项目由学生管理，并且具有异常高的人员流动率：任何给定的维护者只能保证在这里工作四到五年（如果他们留在城里可能会长一点，但除了一些显著的例外，大多数人在完成学生时代后就会离开）。这意味着在任何特定时点，我们都必须担心活跃贡献者的总知识是否足以涵盖系统的所有方面，而语言的熟练程度对于能够有效地管理组件至关重要（我们是学生，我们经常同时担任系统管理员和开发者的角色）。在企业环境中，这种情况不那么突出，但仍然起到作用：员工从一个组转移到另一个组，最终人们会离开或退休。我们目前有两位相当精通 Haskell 的维护者。这种方法的长期可持续性不确定，并且取决于我们能否吸引已经了解或有兴趣学习 Haskell 的潜在学生；在最坏的情况下，人们可能会打开代码，说“这到底是什么鬼”，然后用另一种语言重写它。

1.  *在任何特定时间，有多少维护者感觉在这种语言中能够轻松地进行编程？* 虽然表面上类似于第一个观点，但实际上却大不相同；用不同的方式提出，这是“我能在这种语言中编写完整的程序”与“我能有效地对已写好的程序进行更改”的区别。在某种程度的流畅度上，程序员掌握了一项特殊的技能：能够查看任何 C/Fortran 衍生语言，并从周围的代码中获取他们需要的任何语法知识。这是学习语法和学习新编程范式的区别。我们可能不会同时是 Python/Perl/PHP/Java/Ruby/C 专家，但这些语言的经验相互促进，很多人都能在所有这些语言中拥有工作中的“黑客”知识。但 Haskell 是不同的：它的血统与 Lisp、Miranda 和 ML 相似，而命令式的知识*无法转换*。人们希望仍然能够理解任何给定的 Haskell 代码块做什么，但这仅限于只读能力。

1.  *还有谁在使用它？* 对于团队的一名成员来说，从 Subversion 迁移到 Git 曾是一个非常难以推动的过程，但到目前为止，除了缺少进行迁移的正确基础设施外，他基本上已经被说服这是正确的前进方式。不过，这样做可以接受的一个重要原因是，他们能够列出一些他们经常使用的项目（Linux，我们的内核；AFS，我们的文件系统；Fedora，我们的发行版），这些项目也在使用 Git。但对于 Haskell 来说，我们无法这样说：Haskell 中“大”型的开源高可见应用程序是 Xmonad 和 Darcs，其中许多人从未使用过。作为一个学生团体，我们有更大的自由度来尝试新技术，但缺乏普及意味着更大的风险，而企业对这种风险过敏。

1.  *生态系统成熟吗？* 在内部，我们对 Ruby 的维护者和打包者给予了很多批评，因为他们在向后兼容性方面的记录很糟糕（一次事件使我们无法全局更新我们的 Rails 实例，因为代码会在检测到版本不匹配时自动破坏网站）。在 Haskell 中也能看到一些相似的情况：static-cat 实际上不能在安装了默认软件包的 stock Fedora 11 服务器上构建，因为旧版本的 cgi 模块使用了异常的向后兼容包装器，因此与程序中其他异常处理代码不兼容。进一步的调查发现，cgi 模块实际上并没有在积极维护，并且 Fedora 的`cabal2spec`脚本存在问题。我个人也曾经有过这样的经历，从 Hackage 获得最新库的 Haskell 代码不再编译，因为 API 的漂移使得我的代码无法编译。Cabal install 拒绝一次性升级所有包。

    有许多解决方法。一个缓解因素是，一旦编译了 Haskell 程序，你就不必再担心包的组合问题了。解决方法包括重写我们的代码以前向和后向兼容，对我们的服务器做愚蠢的 Fedora 打包技巧以使 cgi 的两个版本同时存在，说服上游他们确实希望接受新版本，或者维护一个单独的系统范围 cabal 安装。但这并不理想，会让人产生疑问。

我非常幸运能在一个第一点真正重要的环境中工作。我们可以引入 Haskell 到代码库中，并期望长期维护吗？团队中总会有 C 语言的黑客（或者至少应该有；我们一些最重要的安全属性包含在对内核模块的补丁中），但团队中是否总会有 Haskell 的黑客？对于这个问题真的没有一个确切的答案。

我个人保持乐观态度。这是一次实验，你不会在这种环境下有更好的机会让事情发生。Haskell 代码的存在可能会吸引到项目的贡献者，这些贡献者可能最初并不是因为我们是社区的“免费共享网络托管提供者”而被吸引的。Haskell 似乎是唯一一个能够打破主流的语言（抱歉 Simon！），而且在没有一点风险的情况下，哪里会有创新呢？
