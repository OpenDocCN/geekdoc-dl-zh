<!--yml

分类：未分类

日期：2024-07-01 18:17:29

-->

# 安全的多方比特币匿名化：ezyang’s blog

> 来源：[`blog.ezyang.com/2012/07/secure-multiparty-bitcoin-anonymization/`](http://blog.ezyang.com/2012/07/secure-multiparty-bitcoin-anonymization/)
> 
> *摘要.* 我们描述了如何利用安全的多方排序作为比特币匿名化协议的基础，这种协议改进了当前集中式“混合”设计。

比特币是一个[匿名协议](https://en.bitcoin.it/wiki/Anonymity)：虽然比特币地址原则上完全匿名，但进入和离开钱包的所有流量都是公开可见的。通过一些[简单的网络分析](http://anonymity-in-bitcoin.blogspot.com/2011/07/bitcoin-is-not-anonymous.html)，可以将一组地址链接在一起并识别出来。

目前用于比特币匿名化的最先进技术是[混合服务](https://en.bitcoin.it/wiki/Mixing_service)，这是一个信任的第三方钱包，接受传入交易，并在未来的随机时间以随机增量将相应数量转移到您选择的新钱包。其结果是，从该服务分发的任何比特币，都可能来自多个身份。

这类混合服务存在一些显著问题。首先，混合服务必须值得信任，不会保留日志或以其他方式监视混合过程：如果它们被攻破，可以完全追踪任何给定比特币的路径。对于这种情况的通常建议是使用多个混合服务，这样所有这些服务必须被攻破才会失去匿名性。其次，混合服务必须值得信任，不会转身拒绝返还您的资金；这使得这种混合服务对于匿名大量比特币存在风险。最后，大多数混合服务在通常的交易费用之外还收取处理费。

我们提出了一种去中心化、安全的多方协议，用于实施混合协议。这样的系统[已在摘要中提出](https://bitcointalk.org/index.php?topic=12751.msg315793#msg315793)（[也在这里](https://bitcointalk.org/index.php?topic=54266.0;wap2)）；在本文中，我们详细描述了如何实现它，特别是展示了[多方排序](http://www.csc.kth.se/~gkreitz/mpc_sorting/)（一个相对研究充分的算法问题）足以实现此协议。该协议不需要信任的第三方（除了协助发现有兴趣执行混合协议的参与者），不需要你透露你的输入输出地址，仅需最终交易即可执行。

### 协议描述

首先进行一些准备工作：多方排序问题通常如下形式：每个参与方*i*贡献一个输入元素*A[i]*。协议执行后，所有参与方都以秘密共享的形式学习到了排序后的序列*A*，但不知道谁贡献了序列中的任何特定元素*A[i]*。参考[Jónsson, Kreitz and Uddin (2011)](http://www.csc.kth.se/~gkreitz/mpc_sorting/)的工作，我们将这个协议作为一个基本原语：多方排序的基本思想是构建一个固定大小的*排序电路*，然后利用生成的电路描述在多方计算框架上进行操作。

现在描述混合问题。假设有若干方参与将 1 BTC 的硬币混合在一起的过程。（目前假设每位参与者拥有相同数量的比特币；稍后我们将进行推广。）特别地，每位参与者*i*有一个输入钱包*A[i]*（余额至少为 1 BTC）和一个输出钱包*B[i]*，并且只会在转账 1 BTC 到其输出钱包*B[i]*的交易中签署。任何参与该交易的对手都不应能够获知与*A[i]*对应的*B[i]*，除非它是参与交易的输出钱包集合中的一员。

协议的执行步骤如下：

1.  每位参与者声明将使用的输入钱包，并生成签名以证明他们拥有该钱包。这些钱包公开排序为*A*。

1.  将参与输出钱包的每个公钥的数值定义为排序，进行所有输出钱包的安全多方排序。我们现在得到了一个排序好的输出钱包列表*B*，交易的任何成员都不知道谁贡献了哪个输出钱包。每位参与者应检查他们的输出钱包是否包含在这个列表中（以防止拜占庭故障）；如果没有，他们应该中止协议并销毁他们的输出钱包（其身份已泄露）。

1.  构建一笔交易，从排序列表中将 1 BTC 从*A[0]*转账到*B[0]*，*A[1]*转账到*B[1]*，依此类推，并广播给所有参与者。客户端使用其输入钱包对交易进行签名。

1.  一旦所有签名到位，交易即为有效，并广播以纳入区块链。

混合池只有在所有参与者试图混合相同数量的比特币时才起作用。为了管理希望混合更大数量比特币的参与者，我们建议维护不同大小比特币的发现通道，例如...1/4 BTC，1/2 BTC，1 BTC，2 BTC，4 BTC...

### 分析

步骤（1）并未提及输出钱包，因此不能泄露有关输入-输出对应关系的信息。根据定义，步骤（2）不会泄露有关谁贡献了输出钱包的信息。此外，我们甚至不要求排序结果是秘密共享的：一旦交易被发布在区块链上，这个排序列表将成为公开信息。在中止交易的情况下，如果你的输出钱包不在结果中（在拜占庭失败的情况下），情况就会棘手：中止*会*泄露信息，因此你不能在进一步的交易中使用输出钱包。在步骤（3）中，假设攻击者知道正在进行混合交易，输入到输出钱包的确定性映射不会再给所有参与者提供进一步的信息位。因此，这个协议显然满足其安全要求。

这个协议的一个奇怪之处在于，参与者之间没有明确构建任何随机排列。这看起来可能不同寻常，因为人们可能期望的一个自然安全性质是，输出钱包从一个均匀随机选择的输入钱包接收其 1 BTC。然而，这个条件虽然足以保证匿名性，但并非必需。正如添加随机排列会破坏原始排列的所有信息一样，用新的常数排列替换原始排列也会破坏所有原始排列的信息。此外，诚实的参与者会随机选择他们的地址，因此排序过程会自动在这些参与者之间构建一个随机排列（必须排除不诚实的参与者，因为他们可以生成来自倾斜概率分布的地址）。

一个轮次协议授予多少匿名性？考虑这样一种情况，我在一个与我的身份绑定的输入钱包中有 1 BTC，并且我与*n*个诚实参与者一起进行了混合，使用了一个全新的输出钱包。因为没有泄露关于这个输出钱包来源的信息给参与者，一个对手在交易中猜测哪个输出钱包是我的概率为*1/n-1*：这被称为匿名因子。在 Sybil 攻击的情况下，授予的匿名性数量会减少。如果攻击者的比例小于参与者的某个比例（对于许多秘密共享协议来说，被动攻击者的魔数是 1/2，主动攻击者的魔数是 1/3），则匿名因子仍为*1/n-1*，其中*n*是诚实参与者的数量；但*n*小于协议中可见参与者的数量：交易的大小不一定与其匿名性相关！如果攻击者的数量超过这个比例，那么秘密共享方案可能会泄露信息，匿名性不再保证。这为混合协议提供了一种拒绝服务攻击的机会；我们稍后描述一些对抗这种攻击的缓解策略。（注意，无论攻击者有多少，由于第（2）步中的验证步骤，您都保证不会丢失任何比特币。）

### 在实践中

与传统混合一样，应采取一些预防措施，以避免通过侧信道意外泄露有关比特币来源的信息。考虑这样一种情况，Alice 拥有与她真实身份绑定的 2 BTC，并且她希望匿名向 Bob 支付 3/4 BTC。

Alice 首先通过创建一组空钱包来做准备，这些钱包将用于携带匿名的比特币。Alice 通过 Tor 连接到一个 1 BTC 混合的追踪器。（1 BTC 是她想支付给 Bob 的金额，四舍五入。）她等待一个时间窗口到期以进行下一轮混合，然后按照协议提交她的（公开的）输入钱包和（匿名的）输出钱包。如果协议失败，她会丢弃她的输出钱包，并在下次能确定是哪个节点出问题时列入黑名单。

一旦 Alice 成功进行了混合，她会掷一枚硬币（该硬币以概率*1/m*出现正面）。如果硬币出现正面，她会等待进行另一轮混合。她预计要执行的混合交易数量是*m*（遵从几何分布，因此选择它使所有输出钱包在重新混合或退出方面表现一致）。一旦 Alice 退出混合，她现在有一个包含匿名比特币的钱包（更确切地说，这个比特币可能以等概率归因于她参与混合的任何其他钱包）。她向 Bob 转移了 3/4 BTC，留下 1/4 BTC 在她的钱包里。

现在应该将钱包中剩余的比特币视为受污染的（因为它们现在与 Bob 有直接关系，Bob 可能有一个公共钱包）。在用于任何其他目的之前，这些比特币应该分成可混合的金额并重新匿名化。即使匿名化后，这些硬币仍然必须小心使用：特别是它们不能转回原始的公共比特币账户。在这种情况下，混合交易的图结构如下：

（绿色节点是您的公共节点，红色节点是您的匿名节点）。在比特币转账中寻找*循环*的网络分析将能够识别任何交易，即使混淆池中有大量的流动性（尽管有趣的是，如果许多参与者生成循环，这种攻击更难实施）。为了帮助追踪这些硬币，我们建议开发能够处理成千上万个私钥、按“硬币大小”排序，并跟踪与任何给定硬币相关联的易于追踪的交易历史的钱包管理软件。

为了防范 Sybil 攻击，Alice 可能希望慎重选择她的混合跟踪器。某些混合跟踪器可能会收取上市费用：在足够的交易量下，这些费用将使持续的 Sybil 攻击变得更加昂贵。 （然后，这些费用可以被用来支付复杂的混合交易的处理费用，这些交易有着伴随交易费用的社会期望。）每次混合都应该使用不同的 IP 地址进行；如果 Alice 使用 Tor 进行匿名化，她需要每次重新匿名化她的连接。

### 结论

安全多方计算一直是寻求比特币匿名化的用户关注的焦点，但迄今为止还没有任何可信的实施策略。我们希望本文档描述了这样一种实施策略，并为比特币匿名化的生态系统铺平了道路。正如 Bitcoinica 和其他交易所的惨败所示，依赖第三方钱包是危险的。幸运的是，它们也是不必要的。

### 致谢

我要感谢 Eric Price 在制定这一协议中发挥的重要作用。
