<!--yml

category: 未分类

date: 2024-07-01 18:18:29

-->

# 五种高级的 Git 合并技巧：ezyang 的博客

> 来源：[`blog.ezyang.com/2010/01/advanced-git-merge/`](http://blog.ezyang.com/2010/01/advanced-git-merge/)

## 五种高级的 Git 合并技巧

你是否曾经在 Git 中执行过合并，但结果并不如你所希望的那样？例如，你意外地将所有 UNIX 换行符转换为 DOS 换行符，现在整个文件都报告有冲突？也许你看到一个你并不想解决的冲突，想要以他们的版本解决？或者，冲突的文件是空的，你无法弄清楚发生了什么？

这里有一些高级技巧，你可以应用到冲突的合并中，使事情变得更容易一些。其中许多技巧利用了 Git 的底层命令；也就是说，直接与 Git 抽象层（索引、树、提交图）交互的内部命令。其他技巧则简单到只需改变一个配置开关。

1.  使用`git config --global merge.conflictstyle diff3`来转换`diff3`冲突。`diff3`冲突风格在新的`|||||||`标记和`=======`标记之间添加了一个额外的部分，该部分显示了原始内容，你的修改在上面，他们（被合并的分支）的修改在下面。`diff3`是重新建立你几个月前做出的更改背景的强大方式（要查看你的更改，比较中间部分和上部分；要查看他们的更改，比较中间部分和下部分），默认情况下应该开启这个选项，真的没有理由不这样做。

1.  如果你曾经使用过 Subversion，你可能熟悉`FILE.mine`、`FILE.r2`（你最初使用的原始文件）和`FILE.r3`（最新版本检入的文件），以及运行`svn resolve --accept theirs-full`或`mine-full`的能力，这些命令表示“我不关心其他的更改，只使用这个文件的版本”。Git 提供了类似的功能，利用合并的父提交，尽管它们可能更为隐蔽。

    你可能已经熟悉了`git show`命令，它允许你查看提交以及在任何给定提交的树中查看任意的 blob。当你处于合并状态时，你可以使用特殊的`:N:`语法，其中`N`是一个数字，来自动选择其中一个合并父提交。`1`选择共同的基础提交（较低的版本），`2`选择你的版本（"mine"），`3`选择他们的版本（较高的版本）。因此，`git show :3:foobar.txt`会显示`foobar.txt`的上游版本。

    要实际使用其中一种版本作为合并的解决方案，请使用`git checkout {--ours|--theirs} filename.txt`。

1.  当你处于冲突状态时，`git diff`会提供所有发生冲突的详细信息，有时这些信息太多了。在这种情况下，你可以运行`git ls-files -u`查看所有未合并的文件（这比`git status`快得多，并且会省略所有已正确合并的文件）。

    你可能会注意到列表中存在多达三份文件的副本；这告诉你之前提到的“公共”，“我们的”和“他们的”副本的状态。如果 1（公共）丢失，这意味着该文件同时出现在我们的分支和他们的分支中。如果 2（我们的）丢失，这意味着我们删除了该文件，但它在上游有了变更。如果 3（他们的）丢失，这意味着我们做了一些更改，但上游删除了该文件。如果一个文件有冲突，但你无法弄清原因（因为没有冲突标记），这尤其有用。

1.  有时生活会给你柠檬。许多人建议你制作柠檬汁。然而，如果 Git 给了你一个非常糟糕的冲突标记集，例如，你不小心颠倒了一个文件的换行样式，现在整个文件都发生了冲突，那就不要妥协：重新为该文件进行合并。你可以使用方便的`git merge-file`命令来做到这一点。这将运行一个三方文件合并，并接受三个参数：当前文件，公共文件和上游文件，并将合并写入当前文件（第一个参数）。使用`git show`来转储你的文件，公共文件和上游文件，对这些文件进行必要的更改（例如运行`dos2unix`），运行`git merge-file mine common theirs`，然后将`mine`复制到旧的有冲突的文件上。哇，即时得到新的冲突标记集。

    如果你在合并过程中较早发现了全局冲突，并且是你的错，回退合并可能更容易`git reset --hard`，修复错误，然后再尝试合并。然而，如果你已经在合并一个副本时取得了重大进展，重新合并一个单独的文件可能会拯救你的一命。

1.  不要合并，应该变基！而不是运行`git pull`，运行`git pull --rebase`。而不是运行`git merge master`，运行`git rebase master`。结果将会使你的历史记录更清晰，如果你想向上游提交补丁，你将不需要进行大规模的变基马拉松。

现在，继续前进，尽情合并吧！
