<!--yml

category: 未分类

date: 2024-07-01 18:18:26

-->

# 如何像专业人士一样使用 Vim 的 textwidth：ezyang 的博客

> 来源：[`blog.ezyang.com/2010/03/vim-textwidth/`](http://blog.ezyang.com/2010/03/vim-textwidth/)

有许多小的博客文章包含关于 Vim 中各种单行选项的建议。这篇文章属于这一类别，但我希望能对 Vim 配置的一个小子系统：自动换行，进行更全面的介绍。

在编程时，自动换行可能有点讨厌，因为即使代码段超过推荐的 72/80 列宽度，你可能也不想立即将其换行；但如果你在写文档或电子邮件，那确实是你想要的行为。默认情况下，vim 不会为你自动换行；打开它只是一个在需要时能够切换开关的问题。

这里是你关心的配置选项：

+   *textwidth*（或*tw*）：控制你想要使用的换行宽度。使用`:set tw=72`设置换行宽度；默认情况下未设置，因此禁用换行。如果设置了此值，则完全受下面的*formatoptions*影响，这通常是*filetype*敏感的。

+   *formatoptions*（或*fo*）：控制是否启用自动换行，取决于是否设置了`t`标志。使用`：set fo+=t`打开该标志，使用`：set fo-=t`关闭该标志。还有一些辅助的格式选项，但它们并不那么重要。

+   *wrapmargin*（或*wm*）：根据终端大小控制何时换行；我通常认为使用这个功能是一个坏主意。

理解这两个选项之间的互动非常重要。下面是一个简短的互动表：

+   *tw=0 fo=cq wm=0*: 不自动换行，重新换行会在第 80 列处换行

+   *tw=72 fo=cq wm=0*: 不自动换行，重新换行会在第 72 列处换行

+   *tw=0 fo=cqt wm=0*: 不自动换行，重新换行会在第 72 列处换行

+   *tw=0 fo=cqt wm=5*: 在右边缘 5 列处自动换行

+   *tw=72 fo=cqt wm=0*: 在第 72 列自动换行

注意，要实现自动换行，你需要同时设置*fo+=t*和*tw*或*wm*为非零值。还要注意，某些*filetype*会自动给你*fo+=t*，而其他的则不会。

这里是你关心的按键操作：

+   *gq*：执行“格式化操作”，在我们的宇宙中意味着“重新排列文本”。这将尊重前导缩进和符号字符，通常很好，但如果你重新排列一个项目符号点（因为文本将突然在每个前面添加星号），会有点讨厌。

+   段落移动。最重要的是 *vip*（前面的 *v* 将我们放入选择模式），它选择一个“内部段落”；这意味着如果你在段落内的任何位置，你可以输入 *vip*，整个段落将立即为你选择，可能随后可以运行 *gq*。*vap* 也是等效的，尽管它选择整个段落，如果你想删除它，这更合适。大括号在段落之间移动。

*format-options* 的值将大大改变 Vim 的行为，因此我强烈建议将其显示在一个你可以快速参考的地方。我使用：

```
set statusline=...[%{&fo}]...

```

你可能有自己的状态栏；只需将那个小片段减去省略号添加到方便的地方即可。为了更好的效果，我在我的 vimrc 中明确地写入 `set fo-=t`，以防止自己感到惊讶（因为我主要在 vim 中编写代码）。

再来一个巧妙的技巧：

```
augroup vimrc_autocmds
  autocmd BufEnter * highlight OverLength ctermbg=darkgrey guibg=#592929
  autocmd BufEnter * match OverLength /\%74v.*/
augroup END

```

这将突出显示超过 74 列的所有字符（可以根据需要调整该数字）为深灰色（可以根据需要调整该颜色），在没有自动换行时是一个很好的视觉提示，当你需要考虑分行时。
