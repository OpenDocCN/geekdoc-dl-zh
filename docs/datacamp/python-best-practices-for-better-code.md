# 获得更好代码的 6 个 Python 最佳实践

> 原文：<https://web.archive.org/web/20221129035725/https://www.datacamp.com/blog/python-best-practices-for-better-code>

编码是为计算机完成特定任务而编写指令(也称为算法)的艺术。为了与计算机交流，开发人员使用编程语言。

像英语、俄语或盖丘亚语等自然语言一样，编程语言包含一组特定的句法和语义规则，为通信提供了基础。尽管自然语言更复杂、更灵活、更动态，但这些属性也适用于编程语言，只是程度更有限。

你甚至可以用许多不同的方式编写最简单的算法。虽然在开发代码时需要一定的灵活性，但这会影响效率和有效的交流，尤其是当多人一起工作时。

因此，可读性是编写代码时的一个重要方面。为了确保开发人员意见一致，大多数编程语言都制定了编码标准。这些文档提供了生成可读、可维护和可伸缩代码的指南和最佳实践。

在本文中，我们将探索 Python(最流行的数据科学语言之一)的编码最佳实践。下面几节中介绍的实践主要是关于用 Python 编写代码的最佳实践的标准指南 [PEP 8](https://web.archive.org/web/20220818201427/https://www.datacamp.com/tutorial/pep8-tutorial-python-code) 。要了解更多关于 Python 的知识，请查看我们的[Python 入门课程](https://web.archive.org/web/20220818201427/https://www.datacamp.com/courses/intro-to-python-for-data-science)。

## PEP 8 是什么？

“代码被阅读的次数比它被编写的次数多得多。代码应该总是以提高可读性的方式编写”Python 的发明者吉多·范·罗苏姆

PEP 8 是 Python 代码的风格指南。由吉多·范·罗苏姆、巴里·华沙和尼克·科格兰在 2001 年编写的 PEP 8 提供了一组编写更具可读性和一致性的代码的建议。它涵盖了从如何命名变量到一行应该包含的最大字符数的所有内容。

PEP 代表 Python 增强提案。PEP 是一个文档，它描述了为 Python 提出的新特性，并记录了 Python 的一些方面，如设计和风格。

虽然不是强制性的，但是 Python 社区的大部分都使用 PEP 8。因此，遵循指南是非常可取的。通过这样做，你将提高你作为一名职业程序员的资格。

尽管 PEP 8 被广泛接受，但该指南可能不适合所有特定的场景。在这种情况下，公司定义自己的惯例是很常见的。

## 6 个 Python 最佳实践

### 代码质量的 Python 最佳实践

编写可读性强、组织有序的代码可以有所作为，提升你的职业前景。虽然对于初学者来说，编码看起来是一个机械而复杂的过程，但事实是[编码是一门艺术](https://web.archive.org/web/20220818201427/https://www.datacamp.com/blog/ten-lessons-for-future-data-scientists)。

有许多技巧可以帮助你提高 Python 代码的质量。以下是一些最相关的列表。

#### 缩进暴政

缩进是指代码行开头的空格。虽然在其他编程语言中缩进只是为了可读性，但在 Python 中缩进是必须的。Python 使用缩进来打开代码块。更准确地说，每个缩进级别有 4 个连续的空格，如下面的代码所示:

```py
for number in [1,2,3,4]:
    if number % 2 == 0:
        print(number)
    else:
        continue
```

#### 最大线路长度

PEP 8 建议任何一行都不要超过 79 个字符。这是有意义的，因为较短的行更容易阅读。此外，这个长度允许您打开多个相邻的文件。

#### 空白行

用两行空行将顶级函数和类定义括起来。类中的方法定义由一个空行包围。额外的空行可以(有节制地)用于分隔相关函数组。最后，在函数中使用空行来表示逻辑部分。

#### 使用棉绒和自动套用格式

精通代码需要时间。编码时注意所有的细节可能会很有挑战性，也很耗时。幸运的是，机器可以帮助我们确保代码质量，特别是 linters 和 formatters。

Linters 对源代码进行静态分析，并检查是否有对称差异。格式化程序是类似的工具，它试图重新调整代码间距、行长度、参数定位等，以确保不同文件或项目中的代码看起来一致。Python 提供了大量的 linters 和 formatters 供您选择。

#### 牢记原则

虽然前面提到的一些规则很简单，但大多数情况下，编码需要良好的品味和直觉。要成为一名编码艺术家，你应该了解支撑 Python 的一些原则。这类原则的一个很好的例子是 Python 的[禅，将在另一篇文章中介绍。](https://web.archive.org/web/20220818201427/https://www.datacamp.com/blog/lessons-from-the-zen-of-python)

### Python 日志记录最佳实践

日志记录是跟踪某些软件运行时发生的事件的一种方式。特别是当应用程序的规模和复杂性增加时，日志记录成为开发、调试、运行和跟踪性能的关键技术。

为了处理日志实践，[日志](https://web.archive.org/web/20220818201427/https://docs.python.org/3/library/logging.html#module-logging)模块从版本 2.3 开始就是 Python 标准库的一部分。该模块是大多数 Python 开发人员在日志记录方面的首选包。在 [PEP 282 中有广泛的描述。](https://web.archive.org/web/20220818201427/https://peps.python.org/pep-0282/)

日志记录在本质上类似于打印功能。然而，打印功能缺少许多可能对开发人员有用的信息。然而，日志可以记录错误发生的时间戳和行号。它还可以将错误或任何信息记录到文件、套接字等中。

要导入该模块，只需运行以下代码:

```py
import logging
```

并非每个日志消息都相似。事实上，该模块根据消息的严重性提供了一个日志级别类别。内容如下:

*   **NOTSET (0)** :这意味着所有消息都将被记录。
*   **Debug (10)** :用于诊断代码中的问题。
*   Info (20) :它可以确认代码中没有错误。信息级日志记录的一个很好的用例是训练机器学习模型的过程。
*   警告(30) :预示未来可能发生的问题。例如，模块将来可能会停止使用的警告或低 ram 警告。
*   **错误(40)** :代码出现严重 bug 这可能是语法错误、内存不足或异常。
*   **Critical (50)** :程序可能停止运行或突然退出的错误。

```py
import logging
logging.info('This message is just informative')
logging.debug('My missions is to provide information about debugging.')
logging.critical("A Critical Logging Message")
```

说到这里，下面你可以找到在 Python 中处理日志记录时的六个最佳实践的列表。

#### 使用日志代替打印

我们之前说过，日志以与打印功能相同的方式提供信息。然而，日志功能更强大，因为它们可以提供更细粒度的信息。

使用打印功能可能很诱人，尤其是如果你不熟悉日志程序，但是日志永远是最安全的选择。它们更适合扩展和处理复杂的应用程序。

网络上充满了指南和文档。比如这个 DataCamp [日志教程](https://web.archive.org/web/20220818201427/https://www.datacamp.com/tutorial/logging-in-python#log1)可能就是你要找的入门。

#### 使用日志模块

这个模块是大多数 Python 开发人员的首选。这意味着该模块得到了很好的维护，并得到了一个庞大社区的支持，该社区将永远为您的疑问提供答案。

#### 明智地选择日志记录级别

日志模块提供了六种不同级别的消息。它们中的每一个都是为特定的目的而设计的。你越坚持它们，你和用户就越容易理解你的代码中发生了什么。

#### 记录时使用时间戳

这是打印功能所不具备的日志的关键特性。除了知道问题出现在哪里，知道问题何时发生也很重要。在这些情况下，时间戳是你最大的盟友。确保使用标准格式写入时间戳，即 ISO-8601 格式。

#### 清空记录箱

使用 RotatingFileHandler 类(如 TimedRotatingFileHandler)代替 FileHandler 来存档、压缩或删除旧的日志文件，以防止出现内存空间问题。一旦触发了大小限制或时间条件，这些类将清理空间。

### Python 注释最佳实践

注释对于为我们代码的未来读者做注解是非常重要的。尽管很难定义如何对代码进行注释，但我们可以遵循某些指导原则:

*   任何与准则相矛盾的评论都比没有评论更糟糕。这就是为什么我们更新代码是非常重要的，并且不要忘记更新注释以避免产生不一致。
*   注释必须是完整的句子，首字母大写。
*   试着用英语写评论。虽然每个人都可以自由地用他们认为合适的语言来写他们的评论，但建议用英语来写。
*   确保你的评论清晰明了，并且容易被使用你所写语言的其他人理解。

有两种类型的注释:块注释和行内注释。

块注释解释了它后面的代码。通常，块注释的缩进级别与代码块相同。块注释的每一行都以#和一个空格开始，如下所示:

```py
# This is a block comment
print('Welcome to DataCamp!")
```

另一方面，行内注释出现在与代码相同的级别。行内注释应该至少用两个空格与语句隔开。与块注释类似，行内注释以单个散列符号(#)开头，后跟一个空格和一个文本字符串。

```py
print ("Have you ever tried Python?") # This is an inline comment
```

### Python docstring 最佳实践

docstring 是作为模块、函数、类或方法定义中的第一条语句出现的字符串文字。通常，使用文档字符串来自动生成代码文档。因此，可以使用 obj 在运行时访问 docstring。__doc__ 对象特殊属性。

为了一致性，文档字符串总是用三重双引号(" ")括起来。

有两种形式的文档字符串:单行文档字符串和多行文档字符串。一行程序适用于非常明显的情况。它们应该在一行上。以下示例说明了 multiply()函数中的单行 docstring:

```py
def multiply(x, y):
    """ Return the product of two numbers """
    result = x * y
    return result
```

另一方面，多行 docstring 可以跨多行。这样的 docstring 应该记录脚本的函数和命令行语法、环境变量和文件。用法信息可能相当详细，应该足以让新用户正确使用该命令。

```py
def calculate_salary(hours, price=20):
    """ Return the salary according to the hours worked

    Arguments:
    hours: total hours investe
    price: price of each hours worked. Minimum price is 20 dollars
    """
    salary = hours * price
    return salary
```

关于 docstrings 更详细的解释可以在 [PEP257](https://web.archive.org/web/20220818201427/https://peps.python.org/pep-0257/) 中找到。

### Python 文档最佳实践

虽然注释对于与您一起工作的其他开发人员理解您的代码很重要，但是文档旨在帮助潜在用户社区如何使用您的软件。这是关键的一步:不管你的软件有多好，如果文档不够好，或者更糟，缺少文档，人们就不会使用它。

尤其是如果您正在处理一个新项目，包含一个自述文件总是一个好习惯。这些文件通常是代码读者的主要入口点。它们包括给用户和项目维护者的一般信息。

虽然简洁，自述文件应该解释项目的目的，软件的主要来源的 URL，和信用信息。

同样，您应该始终包含一个 setup.py 文件，该文件确保软件或库已经与 Distulils 一起打包和分发，这是分发 Python 模块的标准。

此外，如果您的软件需要其他依赖项或包来运行，您应该包含一个 requirements.txt 文件，它描述了所需的依赖项及其版本。

最后，你可以自由添加任何你认为与潜在用户相关的信息。例如，一个好的实践是提供你的包或函数如何工作的例子。

### Python 虚拟环境最佳实践

为了确保数据项目的顺序和一致性，一个好的做法是为您启动的每个项目创建一个虚拟环境。

虚拟环境，也称为 virtualenvs，有助于分离和隔离项目所需的 Python 和库的版本，以及它们相关的 pip 版本。这授权最终用户安装和管理他们自己的一套软件和版本，这些软件和版本独立于系统提供的软件和版本。

要创建 virtualenvs，我们需要首先安装所需的包，在您的终端中编写以下代码行:

```py
pip install virtualenv
```

为了创建一个新的 virtualenv，下面的代码将变得神奇。我们称这个新的虚拟物为“新虚拟物”

```py
python3 -m venv /path/to/new/virtual/environment/new_venv
```

## Python 命名约定

初学 Python 的开发人员最常犯的一个错误是对变量、类、函数等命名不当。命名约定是确保代码可读性的关键元素。

在 Python 中，命名对象的标准方式在 PEP 8 中有解释。根据指导方针，新的模块和包(包括第三方框架)应该按照这些标准编写，但是如果现有的库有不同的风格，内部一致性是首选的。

一般来说，你应该避免使用太笼统或太世俗的名字。此外，标准库中使用的标识符必须与 ASCII 兼容，如 [PEP 3131 所述。](https://web.archive.org/web/20220818201427/https://peps.python.org/pep-3131/)

```py
# Bad naming:
data_structure, ríos_españa, dictionary_with_countries_and_capitals
# Good naming:
user_profile, stop_words, global_emissions_df
```

下面是 Python 中最常见对象的命名约定列表。

*   **包和模块**

*   包和模块的名字应该都是小写的
*   只有在提高可读性的情况下，才能在包和模块名称中使用下划线。

*   **类**

*   类名应该遵循 UpperCaseCamelCase 约定
*   然而，Python 的内置类通常是小写单词

*   **实例变量、方法和函数**

*   实例变量名应该全部小写
*   使用下划线将新单词添加到变量实例中
*   非公共实例变量应该以单下划线开头

*   **常数**

*   常量名必须全部大写
*   使用下划线向常量添加新单词

| 标识符 | 惯例 |
| 组件 | 小写字母 |
| 班级 | CapWords |
| 功能 | 小写字母 |
| 方法 | 小写字母 |
| 类型变量 | CapWords |
| 常数 | 大写字母 |
| 包裹 | 小写字母 |

确保软件开发活动中的可读性、代码质量和可伸缩性

虚拟环境是一种工具，它通过为每个项目创建单独的隔离环境来分离不同项目的依赖性。

这是一个提供如何编写 Python 代码的标准指南和最佳实践的文档。

缩进是指代码行开头的空格。Python 使用缩进来表示代码块。

Python 的禅是 19 个编写计算机程序的“指导原则”的集合，这些原则影响了 Python 编程语言的设计。

Python docstring 是一个用来记录 Python 模块、类、函数或方法的字符串，因此程序员无需阅读实现细节就能理解它做了什么

有两种类型的注释:块注释和行内注释。