<!--yml

类别：COT 专栏

日期：2024-05-08 11:11:30

-->

# 如何用 GPT-3 构建一个聊天机器人

> 来源：[`every.to/chain-of-thought/how-to-build-a-chatbot-with-gpt-3`](https://every.to/chain-of-thought/how-to-build-a-chatbot-with-gpt-3)

几周前的一个星期五晚上，我醒来收到了一封来自[Lenny Rachitsky](https://twitter.com/lennysan)的电子邮件，他是[Lenny's Newsletter](http://lennysnewsletter.com/)的作者，是 Substack 上最大的通讯之一。他想知道我是如何构建我们 Every 的一个聊天机器人的：

我

*爱*

Lenny。他对 Every 是一个重要的灵感，所以看到他对聊天机器人感兴趣真是令人兴奋。这也为我提供了一个机会，可以测试我一直以来的一个理论

[玩弄](https://every.to/chain-of-thought/i-trained-a-gpt-3-chatbot-on-every-episode-of-my-favorite-podcast)

：

*聊天机器人是创作者的一种新而有价值的内容格式*。

我知道 Lenny 的观众会是测试这个理论的完美方式：

+   它很大（他有 30 万订阅者）。

+   他们的参与度很高。

+   他的所有帖子都是长青的。

+   它们经常被用作参考资料。

出于这些原因，将他的帖子以聊天机器人的形式提供是有意义的。与其不得不浏览他的存档来回答一个产品问题，他的任何订阅者都可以问机器人，而且会立即得到答案。

我知道基于我们已经完成的工作，为他构建一个这样的机器人会很容易——所以我提出了为他制作一个的建议：

他说好，第二天我一早醒来就给他交付了一个 Lenny 聊天机器人，它可以根据他的通讯档案提供答案：

在接下来的几周里，我还写了一篇文章，

[以客座帖子的形式发布在他的通讯中](https://www.lennysnewsletter.com/p/39b613d6-063b-45df-9a8e-40fece9d6bde)

，关于我如何构建机器人。这是对 GPT-3 如何工作以及如何使用它轻松创建像这样的问答机器人的详细、逐步指南——无需编程经验。它在星期二上线，成为 Lenny 有史以来流量最高的一天：

这是一次疯狂的旅程，我正在为你们所有人同步全文。还有

**一个专门为每位付费订阅者准备的底部部分**。

：

+   发布日回顾，包括指标

+   服务器端代码示例。

+   客户端聊天机器人代码示例。

如果你想阅读完整的文章，包括代码示例，请在这里订阅：

希望你喜欢！

* * *

我用 GPT-3 构建了一个 Lenny 聊天机器人

Lenny 的通讯很棒，但是它是单向的。它和你交谈，但你不能回答。如果你能问 Lenny 的通讯一个问题，那不是很棒吗？

现在这是可能的。

在一个星期的时间里，我为 Lenny 构建了一个 AI 驱动的聊天机器人，它使用他的整个通讯档案来回答您关于产品、增长和初创公司的任何问题。它是用 GPT-3 构建的，从头到尾只用了几个小时。在这篇文章中，我将详细解释 Lenny Bot 的工作原理，这样你就可以学会自己构建一个。

你也可以立即使用它👇

GPT-3 等 AI 技术仍处于起步阶段，但它们很快就会无处不在。了解它们的工作方式对你的技术职业，尤其是产品开发将至关重要。为了迎接迅速到来的未来，最好的准备方式是投入其中，动手实践。

如果你没有技术背景，开始可能会让人畏惧。但我将从最基础的知识开始讲起。你将能够理解我在说什么，并开始使用它，*无需编程**。*（而且，如果你有任何问题，可以随时将它们粘贴到 ChatGPT 中——它会给你良好的回应；）

## 序言：GPT-3 和 ChatGPT 的区别

你可能听说过 GPT-3 和 ChatGPT。也许你将这些术语混用，或者你可能并不确定它们的区别。花点时间来理解它们的区别是值得的。

GPT-3 和 ChatGPT 都是“大型语言模型”（LLMs）。这些是可以生成自然听起来的文本、代码等的机器学习模型。它们通过大量的文本数据集进行训练，有助于它们掌握自然语言任务，如回答问题、写营销文案和进行对话。那么它们之间的区别是什么？为什么这很重要？

GPT-3 是一个通用语言模型：它可以进行对话，编写代码，完成博客文章，进行翻译任务等。你可以把它想象成一个灵活的全能型人物，可以在你想要的任何话题上阐述。

ChatGPT 是 GPT-3 的一个版本，它被打造成了一个友好、无攻击性的外向型个体。基本上，它经过训练擅长进行对话。其创造者 OpenAI 通过不断地与模型进行对话，对好的回应进行奖励，对不好的回应进行惩罚——这个过程被称为[人类反馈的强化学习](https://huggingface.co/blog/rlhf)。

你可能会认为既然我们正在构建一个聊天机器人，我们会使用 ChatGPT，对吧？不幸的是，OpenAI 并没有为我们创建一种方式来直接与 ChatGPT 模型互动——你只能通过 ChatGPT Web 应用程序使用它。所以它不适合我们的目的。

我们希望能够直接与模型互动，而不是通过一个中介应用。所以我们将使用 GPT-3 进行探索。它将为我们提供构建聊天机器人所需的所有力量和灵活性。

我们将以两种方式来进行：首先使用[OpenAI 的 Playground](https://platform.openai.com/playground)起步，之后再加上一点代码。Playground 是一个 Web 应用程序，让你提示 GPT-3 并得到回应，让我们来实验的绝佳地方。

让我们从这里开始，看看事情的发展情况。

## GPT-3 的基础知识

解释 GPT-3 的基本方式是它喜欢帮你完成句子。你提供一组起始词，它会尝试找出从你的输入中最可能跟随的词组。你可以提供任何一组词。它非常灵活，可以谈论任何你想要的话题，从产品管理到天体物理学。

你提供的词组称为*提示*，而你从 GPT-3 得到的答案称为*完成*。

下面是 [GPT-3 游乐场](https://platform.openai.com/playground?model=text-davinci-003) 中的一个简单示例。非绿色文本是我输入的提示，绿色文本是 GPT-3 返回的完成：

你可以看到，GPT-3 在像这样简单的完成上表现得很好。但是即使提示变得更加复杂，它也会表现得很好。

例如，你可以要求它定义产品市场匹配：

这还不错！因为它已经能够回答产品问题，所以看起来它对我们的莱尼聊天机器人来说将会很有用。

你可能会认为，在后台，GPT-3 有一个概念手册，它用来理解你的句子并生成正确的完成。但实际上，它是一个概率引擎——一个非常擅长的概率引擎，在给定提示的情况下，找到最有可能跟随它的词语。

它之所以能做到这一点，是因为它通过分析整个互联网上的句子的统计概率来进行训练，所以它有很多数据可以学习。（所有关于产品市场匹配的 Medium 文章都是有用的！）

如果你想从技术角度了解更多关于这个工作原理的信息，我建议查看安德烈·卡尔帕西的 [视频](https://www.youtube.com/@AndrejKarpathy)。

## 将 GPT-3 转变成聊天

现在我们让机器人回答问题了，但是我们如何让它真正与我们交流呢？

理想情况下，我们希望它能接收用户的消息并做出回应。我们还希望给它一点个性。如果它听起来像莱尼本人一样——温暖、友好和聪明，那就太棒了。

使用 GPT-3 做到这一点也相当简单。我们可以在提示中要求它以这种方式行事：

正如你所见，GPT-3 已经阅读了足够多的聊天机器人对话和产品管理文章，以便根据这种类型的提示开始与我们对话。

我们可以通过写更多的记录来继续与它对话：

注意我们正在做什么：每次运行模型时，我们都必须向其提供先前对话中的整个记录。这指导了它的回复：

成功！它正在与我们就产品管理等问题进行高水平的交流，比如如何制定路线图。

但是如果我们想要回答更难的问题呢？例如，莱尼的新闻通讯的最大价值之一是他提供了大量基准数据，这样你就可以衡量自己在业界的表现如何。

如果我们回顾一下 Lenny 的存档，我们会发现在他关于[激活率](https://www.lennysnewsletter.com/p/what-is-a-good-activation-rate)的文章中，不同类型产品的平均激活率约为 34%，中位数为 25%。

让我们问问 GPT-3，看看它是否知道这个：

不错！它的答案差不多，但是它对良好激活率的估计略低于 Lenny 数据显示的平均值。理想情况下，由于它是 Lenny 的聊天机器人，我们希望它返回他在文章中提供的基准值。

一旦我们开始真正审视这个机器人，这种问题就会变得更加严重。例如，如果我们问它 Substack 的第一个出版商是谁——Lenny 在他的文章中提到的一个[话题](https://www.lennysnewsletter.com/p/consumer-business-find-first-users)——它会说是 Andrew Sullivan：

这个答案听起来很自信，但是是错误的。（正确答案是 [Bill Bishop](https://sinocism.com/)。）这不是一个孤立事件。例如，如果我问：“消费者初创企业的最佳创意是否应该来自试图解决自己问题的创始人？”它回答道：

这是自信的——也是错误的。正如 Lenny 在他的文章中所说的那样

[启动和扩展消费型企业](https://www.lennysnewsletter.com/p/kickstarting-and-scaling-a-consumer)

，不到三分之一的消费者初创企业创意来自解决自己问题的创始人。所以这不是“绝对”是最佳实践。

发生了什么？有两个相互交织的问题：

1.  **GPT-3 倾向于“幻觉”**。[幻觉](https://en.wikipedia.org/wiki/Hallucination_(artificial_intelligence))是一个技术术语，指的是模型倾向于根据所询问的内容返回荒谬或错误的补全。该模型就像一个聪明而热心的六岁孩子。即使它不知道自己在说什么，也会尽力给出一个好答案。OpenAI 和其他基础模型公司正在积极解决这个问题，但这仍然很常见。第二个问题加剧了这个问题。

1.  **GPT-3 可能没有正确的数据。** GPT-3 有一个知识截止点——这意味着它用于生成响应的所有信息都在 2021 年冻结。此外，Lenny 的许多写作都在付费墙后面。这意味着即使 GPT-3 已经阅读了整个互联网，它也无法使用他的新闻简报材料来构建答案。

那么我们如何构建一个能解决这些问题的 GPT-3 聊天机器人呢？理想情况下，我们希望向 GPT-3 提供它回答问题所需的信息。这样它就会有正确的信息可用，并且更不可能胡言乱语。

有一个简单的方法可以做到这一点。

## 将上下文装入提示

当我上高中的时候，有一位物理老师允许开卷考试。他允许你带一张索引卡去考试，上面写上你认为需要回答问题所需的任何公式。

记住公式并不重要，重要的是使用您的推理能力将公式转化为正确的答案。

人们会带着满满一页微小字迹来参加考试，这是一个有用的策略。这些公式为您提供了您需要思考测试问题答案的上下文，因此测试变得不再是关于您的记忆，而是关于您对主题的理解有多好。（我在那门课上得了 B，所以我的理解还算平均。）

您可以以类似的方式与 GPT-3 合作。如果在您的提示中包含等效于便条的内容以帮助其回答问题，它通常会回答正确。（它的推理能力比我的好。）

让我们回到之前 GPT-3 失败的一个示例，看看我们是否可以用这种技术纠正它。

正如我上面提到的，在他关于消费型企业的帖子中，Lenny 指出不到三分之一的创始人从尝试解决自己的问题中获得了想法：

上次，当我们问 GPT-3 消费型企业创始人是否最好尝试解决自己的问题时，它回答说：“绝对是！”考虑到 Lenny 的文章内容，这是错误的。

让我们再次向 GPT-3 提出这个问题——但稍微帮助一下。我们将向其提供相当于一张便条的内容，上面写着 Lenny 文章中含有答案的部分。然后我们看看它是否能回答正确。

为了公平起见，我们不只是提供包含答案的文本。我们还会提供文章中的一些周围文本，以查看它的表现如何。让我们看看它是否有效：

成功！现在它告诉我们，不到三分之一的创始人试图解决自己的问题。我们只需把 Lenny 的所有文章写在一张便条上，与任何问题一起输入模型，它就会根据他所写的内容回答。

但这带来了另一个问题：空间限制。

便条的类比很贴切，因为提示中的空间有限——目前约为 4,000 个标记（每个标记相当于三分之四个单词）。因此，我们不能在每个问题上都提供 Lenny 的整个存档。我们必须谨慎选择。

让我们谈谈如何解决这个问题。

## 嵌入 Lenny 的存档

到目前为止，我们将不得不退出与 GPT-3 Playground 的手动交互，开始使用直接与 GPT-3 API 一起工作的代码块。我们正在构建的代码将执行以下任务：

1.  我们需要以一种便于我们的机器人进行轻松搜索的方式下载和存储 Lenny 的存档。

1.  我们需要一些代码来帮助从我们在上一步创建的 Lenny 内容的存档中找到相关文本片段。

1.  当用户提问时，我们希望使用上一步的代码来获取最有可能回答问题的文本片段，并将它们放入我们发送给 GPT-3 的提示中。

1.  我们将向用户显示生成的答案。

这可以通过一个名为[GPT Index](https://gpt-index.readthedocs.io/en/latest/)的库来完成，这是一个由[Jerry Liu](https://twitter.com/jerryjliu0)创建的开源库。它与 OpenAI 分开，但是构建它以帮助完成这样的任务。它的工作原理如下：

1.  创建一组文章片段的索引。

1.  找到最相关的片段。

1.  使用最相关的片段向 GPT-3 提问。

*注意：* 这将变得有点复杂和技术性。如果你对此感兴趣，请继续阅读解释。

您可以在[Google Colab 文件](https://colab.research.google.com/drive/1p2AablavDkSXly6H-XNLoSylMtoz7NDG?usp=sharing)中访问并运行本文中的代码。Colab 是一个基于云的编程环境，让您可以从浏览器中运行所有内容。（如果您对此有任何疑问，请在[Twitter](https://www.twitter.com/danshipper)上联系我。）

如果您对技术细节不感兴趣，请跳到最后尝试聊天机器人。

仍然在这里吗？太好了。让我们从构建索引开始。

### 构建我们的索引

我们需要做的第一件事是构建我们的索引。你可以把索引想象成一个数据库：它以一种使它们易于搜索的方式存储一系列文本片段。

首先，我们将 Lenny 的新闻通讯存档收集到一个文件夹中。然后我们要求 GPT Index 获取文件夹中的所有文件，并将每个文件分解成小的、连续的片段。然后我们以可搜索的格式存储这些片段。

代码看起来像这样：

当我们运行这个函数时，我们将创建一个名为 index.json 的文件，其中包含将 Lenny 的文章转换为可搜索格式的片段。这些被称为

[嵌入](https://platform.openai.com/docs/guides/embeddings)

—每个文本片段的简化数学表示。就像经度和纬度可以帮助您判断地图上两个城市之间有多近一样，嵌入也可以为文本片段做同样的事情。如果你想知道两个文本片段是否相似，就计算它们的嵌入并进行比较。嵌入“更接近”的文本片段是相似的。

嵌入很方便，因为当用户提问时，它们将使搜索 Lenny 的存档并找到最有可能回答我们问题的文章变得容易。

有了这个想法，让我们运行代码，看看会发生什么。

### 成功！ Lenny 的存档已完全索引，我们可以查询它以找到相关的文档片段，并使用这些片段回答我们的问题。（如果您用大文档做这个，要小心，因为每 1,000 个标记的嵌入成本是 0.0004 美元。）问我们的问题

要查询我们在上一节中创建的索引，我们所要做的就是将一个问题粘贴到 GPT Index 中。然后它将：

+   找到与我们问题最相关的索引片段。

+   将这些片段和我们的问题合并成一个提示，然后发送给 GPT-3。

+   打印输出。

这是代码的样子：

如果我问它，“消费者社交产品的良好留存率是多少？”它会说：

“25% 是好的。”

如果我查询：“消费者初创公司的最佳创意是来自试图解决自己问题的创始人吗？”它会返回正确的答案：

*“根据研究，似乎消费者初创公司的最佳创意来自试图解决自己问题的创始人，因为这是约 30% 最成功的消费者公司使用的策略。”*

*然而，并非一定是最佳策略，因为其他策略，如关注好奇心、已经奏效的事物和范式转变，也被许多成功公司采用过。”*

我们现在有了一个端到端的解决方案，可以将问题转化为基于 Lenny 存档的答案。而且这只需要几行代码！

如果您想看到结果，可以查看这个机器人：

您还可以访问

[完整源代码](https://colab.research.google.com/drive/1p2AablavDkSXly6H-XNLoSylMtoz7NDG#scrollTo=4gHdfdtsSGEW)

为了这篇文章在此 Colab 笔记本中。更多的细节专门为每位订阅者在本文的底部。

## 所有这一切意味着什么

这只是一个开始。随着这些技术的发展，可能性的地平线几乎每天都在变化。今天难以实现的事情将在几个月内变得容易。

每个新闻通讯、书籍、博客和播客，作为受众永久参考信息使用，现在都可以重新打包成一个聊天机器人。

这对观众来说是很棒的，因为这意味着无论何时您想知道 Lenny（或任何其他创作者）对某个话题的看法，您都不必整理一堆文章或播客集数的存档，以获取他们对您问题的答案。相反，您只需使用 Lenny 的聊天机器人即可立即获得他的答案，然后如果您想要更多细节，可以稍后阅读完整文章。

这对内容创作者也是好事。他们现在有能力以新的方式变现他们已经创作的内容，并减少他们需要回答的重复问题的数量。这将（希望）给他们更多的时间和金钱去创造优秀的内容。

一类新的内容创作者将学会创建引人注目的聊天机器人体验，将其个性和世界观与其特定受众结合起来，就像某些创作者学会创建引人注目的 YouTube 视频、通讯文章或 TikTok 短片一样。

如果您使用 Lenny 的聊天机器人或者关注代码示例，您会发现它很有前景，但还不完美。对于那些学会如何让这些类型的体验对用户来说令人难以置信的个人或团体来说，将获得巨大的回报。

我希望这能激励您踏上这段旅程。

* * *

﻿﻿每位订阅者的更多细节

在这一部分中，我将给每位付费订阅者更新以下内容：

+   发布日的情况

+   服务器端代码示例

+   包括 React 代码和 CSS 的客户端代码示例

让我们开始吧！

了解更多

### 这篇文章是

付费订阅者

订阅 →

或者，登录。
